#!/usr/bin/env python3
# -*- coding: utf-8 -*-
#
# Author:  Dominik Gresch <greschd@gmx.ch>
# Date:    15.10.2014 10:22:43 CEST
# File:    tb_example.py

from common import *

import os
import types
import shutil

class TbModelTestCase(BuildDirTestCase):

    def create_model(self, t1, t2):
        on_site = [1, 1, -1, -1]
        hoppings = [[0, 2, [0, 0, 0], t1],
                    [0, 2, [-1, 0, 0], t1 * (-1j)],
                    [0, 2, [-1, -1, 0], t1 * (-1)],
                    [0, 2, [0, -1, 0], t1 * (1j)],
                    [1, 3, [0, 0, 0], t1],
                    [1, 3, [-1, 0, 0], t1 * (1j)],
                    [1, 3, [-1, -1, 0], t1 * (-1)],
                    [1, 3, [0, -1, 0], t1 * (-1j)],
                    [0, 0, [1, 0, 0], t2],
                    [0, 0, [0, 1, 0], t2],
                    [1, 1, [1, 0, 0], t2],
                    [1, 1, [0, 1, 0], t2],
                    [2, 2, [1, 0, 0], -t2],
                    [2, 2, [0, 1, 0], -t2],
                    [3, 3, [1, 0, 0], -t2],
                    [3, 3, [0, 1, 0], -t2]]
                    
        positions = [[0., 0., 0.], [0., 0., 0.], [0.5, 0.5, 0.], [0.5, 0.5, 0.]]
        self.model = z2pack.em.tb.Model(on_site, hoppings, positions, occ=2)

    # this test may produce false negatives due to small numerical differences
    def test_res1(self):
        self.create_model(0.2, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False, num_strings=20, pickle_file=None)

        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.49993971392030712, 0.50006028607969299], [0.49839809346166608, 0.50160190653833414], [0.49777184404653835, 0.5022281559534616], [0.49451593469679561, 0.50548406530320455], [0.49458102112100638, 0.50541897887899367], [0.4903638545336429, 0.50963614546635727], [0.48751533406257919, 0.51248466593742081], [0.48697693454976615, 0.51302306545023391], [0.48226564181901066, 0.51773435818098934], [0.47570697515289351, 0.52429302484710671], [0.47100070960259227, 0.5289992903974079], [0.45989755060452209, 0.54010244939547791], [0.44107069988514241, 0.55892930011485775], [0.42258199845339084, 0.57741800154660949], [0.38071876959972001, 0.61928123040028005], [0.32425083021904744, 0.67574916978095256], [0.24653322016249735, 0.75346677983750276], [0.15959501256116448, 0.84040498743883574], [0.0794046644801219, 0.92059533551987804], [0.0014565534680155345, 0.99854344653198457]], 'lambda_': [array([[ -9.99999928e-01+0.00033091j,  -5.79552927e-05+0.00017499j],
       [  5.79552927e-05+0.00017499j,  -9.99999928e-01-0.00033091j]]), array([[ -9.99949348e-01-0.01006034j,   2.54407348e-04-0.0001646j ],
       [ -2.54407348e-04-0.0001646j ,  -9.99949348e-01+0.01006034j]]), array([[ -9.99902003e-01-0.01369004j,  -4.96644043e-04+0.00288459j],
       [  4.96644043e-04+0.00288459j,  -9.99902003e-01+0.01369004j]]), array([[-0.99940640-0.03442998j, -0.00102744+0.00060299j],
       [ 0.00102744+0.00060299j, -0.99940640+0.03442998j]]), array([[-0.99942041-0.03386779j, -0.00132044+0.0031746j ],
       [ 0.00132044+0.0031746j , -0.99942041+0.03386779j]]), array([[-0.99816767-0.0604401j , -0.00256882+0.00130328j],
       [ 0.00256882+0.00130328j, -0.99816767+0.0604401j ]]), array([[-0.99692489-0.07807345j, -0.00652206-0.00166316j],
       [ 0.00652206-0.00166316j, -0.99692489+0.07807345j]]), array([[-0.99665409-0.08164318j,  0.00315198-0.00225258j],
       [-0.00315198-0.00225258j, -0.99665409+0.08164318j]]), array([[-0.99379829-0.11115468j, -0.00309124-0.00019051j],
       [ 0.00309124-0.00019051j, -0.99379829+0.11115468j]]), array([[-0.98837348-0.15202139j,  0.00227225-0.00147912j],
       [-0.00227225-0.00147912j, -0.98837348+0.15202139j]]), array([[-0.98344601-0.17945577j, -0.02176859+0.01247771j],
       [ 0.02176859+0.01247771j, -0.98344601+0.17945577j]]), array([[-0.96842288-0.247966j  , -0.02543184+0.00481831j],
       [ 0.02543184+0.00481831j, -0.96842288+0.247966j  ]]), array([[-0.93223195-0.3596837j ,  0.03905663+0.00676821j],
       [-0.03905663+0.00676821j, -0.93223195+0.3596837j ]]), array([[-0.88400660-0.46505698j, -0.04182879-0.02246536j],
       [ 0.04182879-0.02246536j, -0.88400660+0.46505698j]]), array([[-0.73205271-0.67083314j,  0.11819815+0.01053196j],
       [-0.11819815+0.01053196j, -0.73205271+0.67083314j]]), array([[-0.44979136-0.89280784j,  0.02123964+0.01143542j],
       [-0.02123964+0.01143542j, -0.44979136+0.89280784j]]), array([[ 0.02178070-0.99049701j,  0.03607261+0.13092002j],
       [-0.03607261+0.13092002j,  0.02178070+0.99049701j]]), array([[ 0.53797354 -8.42955824e-01j, -0.00310705 -5.38769310e-04j],
       [ 0.00310705 -5.38769310e-04j,  0.53797354 +8.42955824e-01j]]), array([[ 0.87810259-0.47818837j, -0.00540566+0.01557238j],
       [ 0.00540566+0.01557238j,  0.87810259+0.47818837j]]), array([[ 0.99995812-0.00761364j, -0.00485131-0.00150008j],
       [ 0.00485131-0.00150008j,  0.99995812+0.00761364j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.2204460492503131e-16, 0.0, 0.0, 0.5, 0.50000000000000011, 0.49999999999999994, 0.5]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_res2(self):
        """ test pos_check=False """
        self.create_model(0, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                            num_strings=20,
                            pickle_file=None,
                            pos_tol=None)

        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.5, 0.5], [0.625, 0.625], [0.625, 0.625], [0.625, 0.625], [0.625, 0.625], [0.75, 0.75], [0.75, 0.75]], 'lambda_': [array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-1. -1.66533454e-16j,  0. +0.00000000e+00j],
       [ 0. +0.00000000e+00j, -1. -1.66533454e-16j]]), array([[-0.70710678+0.70710678j,  0.00000000+0.j        ],
       [ 0.00000000+0.j        , -0.70710678+0.70710678j]]), array([[-0.70710678+0.70710678j,  0.00000000+0.j        ],
       [ 0.00000000+0.j        , -0.70710678+0.70710678j]]), array([[-0.70710678+0.70710678j,  0.00000000+0.j        ],
       [ 0.00000000+0.j        , -0.70710678+0.70710678j]]), array([[-0.70710678+0.70710678j,  0.00000000+0.j        ],
       [ 0.00000000+0.j        , -0.70710678+0.70710678j]]), array([[ -1.11022302e-16+1.j,   0.00000000e+00+0.j],
       [  0.00000000e+00+0.j,  -1.11022302e-16+1.j]]), array([[ -1.11022302e-16+1.j,   0.00000000e+00+0.j],
       [  0.00000000e+00+0.j,  -1.11022302e-16+1.j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.125, 0.125, 0.125, 0.125, 0.25, 0.25]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_res3(self):
        """ test gap_tol=None """
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                            num_strings=20,
                            pickle_file=None,
                            gap_tol=None)

        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.4999877229169376, 0.5000122770830624], [0.49956475705501235, 0.50043524294498765], [0.4992387807325534, 0.50076121926744688], [0.49902825613107976, 0.50097174386892029], [0.49855386122808587, 0.50144613877191424], [0.49740259262205089, 0.50259740737794922], [0.49651104294287929, 0.50348895705712093], [0.49589349414615097, 0.5041065058538492], [0.49466965504030902, 0.50533034495969109], [0.49256858760975153, 0.50743141239024858], [0.49074703814921827, 0.50925296185078184], [0.48552226537253468, 0.51447773462746538], [0.47717727892234607, 0.52282272107765393], [0.46350315182712359, 0.53649684817287624], [0.41699779540947846, 0.58300220459052154], [0.32972611989658401, 0.67027388010341582], [0.22704073347978979, 0.77295926652021019], [0.14243318684650572, 0.85756681315349437], [0.067698120632063319, 0.93230187936793685], [0.0013721964517045919, 0.99862780354829539]], 'lambda_': [array([[ -9.99999997e-01 +7.11082504e-05j,
         -1.37682150e-05 +2.65425560e-05j],
       [  1.37682150e-05 +2.65425560e-05j,
         -9.99999997e-01 -7.11082504e-05j]]), array([[ -9.99996261e-01 -2.73433982e-03j,
          4.36274411e-05 -1.06730211e-05j],
       [ -4.36274411e-05 -1.06730211e-05j,
         -9.99996261e-01 +2.73433982e-03j]]), array([[ -9.99988562e-01-0.00477624j,  -7.48831845e-05+0.00024014j],
       [  7.48831845e-05+0.00024014j,  -9.99988562e-01+0.00477624j]]), array([[ -9.99981361e-01-0.00610168j,  -1.27593620e-04-0.00017792j],
       [  1.27593620e-04-0.00017792j,  -9.99981361e-01+0.00610168j]]), array([[ -9.99958719e-01-0.00907334j,  -2.23135474e-04+0.0004293j ],
       [  2.23135474e-04+0.0004293j ,  -9.99958719e-01+0.00907334j]]), array([[ -9.99866832e-01 -1.63131035e-02j,
         -4.46597646e-04 +4.11736696e-05j],
       [  4.46597646e-04 +4.11736696e-05j,
         -9.99866832e-01 +1.63131035e-02j]]), array([[ -9.99759728e-01-0.02190142j,  -8.67248757e-04-0.00024964j],
       [  8.67248757e-04-0.00024964j,  -9.99759728e-01+0.02190142j]]), array([[ -9.99667148e-01-0.02578765j,   7.19067833e-04-0.00026875j],
       [ -7.19067833e-04-0.00026875j,  -9.99667148e-01+0.02578765j]]), array([[ -9.99439211e-01 -3.34808440e-02j,
         -5.43139246e-04 -4.84772598e-05j],
       [  5.43139246e-04 -4.84772598e-05j,
         -9.99439211e-01 +3.34808440e-02j]]), array([[ -9.98910083e-01-0.0466721j ,   4.53354194e-04-0.00039512j],
       [ -4.53354194e-04-0.00039512j,  -9.98910083e-01+0.0466721j ]]), array([[-0.99831046-0.05796809j, -0.00355797+0.00180852j],
       [ 0.00355797+0.00180852j, -0.99831046+0.05796809j]]), array([[-0.99586542-0.09068864j, -0.00518335+0.00087717j],
       [ 0.00518335+0.00087717j, -0.99586542+0.09068864j]]), array([[-0.98973591-0.14262975j,  0.00876179+0.00167428j],
       [-0.00876179+0.00167428j, -0.98973591+0.14262975j]]), array([[-0.97382200-0.22684101j, -0.01437382-0.00269481j],
       [ 0.01437382-0.00269481j, -0.97382200+0.22684101j]]), array([[-0.8670638-0.49626463j,  0.0435676+0.00486277j],
       [-0.0435676+0.00486277j, -0.8670638+0.49626463j]]), array([[-0.48024498 -8.77119578e-01j,  0.00509828 +1.17068612e-04j],
       [-0.00509828 +1.17068612e-04j, -0.48024498 +8.77119578e-01j]]), array([[ 0.14375751-0.98565666j,  0.01042592+0.08778401j],
       [-0.01042592+0.08778401j,  0.14375751+0.98565666j]]), array([[ 0.62557023 -7.80166025e-01j,  0.00165766 +3.44896109e-04j],
       [-0.00165766 +3.44896109e-04j,  0.62557023 +7.80166025e-01j]]), array([[ 0.91089031-0.41263672j, -0.00100123+0.00296375j],
       [ 0.00100123+0.00296375j,  0.91089031+0.41263672j]]), array([[ 0.99996283-0.00300278j, -0.00162107+0.0079176j ],
       [ 0.00162107+0.0079176j ,  0.99996283+0.00300278j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.99999999999999989, 0.0, 0.99999999999999989, 0.5, 0.5, 0.5, 0.5]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_res4(self):
        """ test move_tol=None """
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                          num_strings=20,
                          pickle_file=None,
                          move_tol=None)

        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.4999877229169376, 0.5000122770830624], [0.49956475705501235, 0.50043524294498765], [0.4992387807325534, 0.50076121926744688], [0.49902825613107976, 0.50097174386892029], [0.49855386122808587, 0.50144613877191424], [0.49740259262205089, 0.50259740737794922], [0.49651104294287929, 0.50348895705712093], [0.49589349414615097, 0.5041065058538492], [0.49466965504030902, 0.50533034495969109], [0.49256858760975153, 0.50743141239024858], [0.49074703814921827, 0.50925296185078184], [0.48552226537253468, 0.51447773462746538], [0.47717727892234607, 0.52282272107765393], [0.46350315182712359, 0.53649684817287624], [0.41699779540947846, 0.58300220459052154], [0.32972611989658401, 0.67027388010341582], [0.22704073347978979, 0.77295926652021019], [0.14243318684650572, 0.85756681315349437], [0.067698120632063319, 0.93230187936793685], [0.0013721964517045919, 0.99862780354829539]], 'lambda_': [array([[ -9.99999997e-01 +7.11082504e-05j,
         -1.37682150e-05 +2.65425560e-05j],
       [  1.37682150e-05 +2.65425560e-05j,
         -9.99999997e-01 -7.11082504e-05j]]), array([[ -9.99996261e-01 -2.73433982e-03j,
          4.36274411e-05 -1.06730211e-05j],
       [ -4.36274411e-05 -1.06730211e-05j,
         -9.99996261e-01 +2.73433982e-03j]]), array([[ -9.99988562e-01-0.00477624j,  -7.48831845e-05+0.00024014j],
       [  7.48831845e-05+0.00024014j,  -9.99988562e-01+0.00477624j]]), array([[ -9.99981361e-01-0.00610168j,  -1.27593620e-04-0.00017792j],
       [  1.27593620e-04-0.00017792j,  -9.99981361e-01+0.00610168j]]), array([[ -9.99958719e-01-0.00907334j,  -2.23135474e-04+0.0004293j ],
       [  2.23135474e-04+0.0004293j ,  -9.99958719e-01+0.00907334j]]), array([[ -9.99866832e-01 -1.63131035e-02j,
         -4.46597646e-04 +4.11736696e-05j],
       [  4.46597646e-04 +4.11736696e-05j,
         -9.99866832e-01 +1.63131035e-02j]]), array([[ -9.99759728e-01-0.02190142j,  -8.67248757e-04-0.00024964j],
       [  8.67248757e-04-0.00024964j,  -9.99759728e-01+0.02190142j]]), array([[ -9.99667148e-01-0.02578765j,   7.19067833e-04-0.00026875j],
       [ -7.19067833e-04-0.00026875j,  -9.99667148e-01+0.02578765j]]), array([[ -9.99439211e-01 -3.34808440e-02j,
         -5.43139246e-04 -4.84772598e-05j],
       [  5.43139246e-04 -4.84772598e-05j,
         -9.99439211e-01 +3.34808440e-02j]]), array([[ -9.98910083e-01-0.0466721j ,   4.53354194e-04-0.00039512j],
       [ -4.53354194e-04-0.00039512j,  -9.98910083e-01+0.0466721j ]]), array([[-0.99831046-0.05796809j, -0.00355797+0.00180852j],
       [ 0.00355797+0.00180852j, -0.99831046+0.05796809j]]), array([[-0.99586542-0.09068864j, -0.00518335+0.00087717j],
       [ 0.00518335+0.00087717j, -0.99586542+0.09068864j]]), array([[-0.98973591-0.14262975j,  0.00876179+0.00167428j],
       [-0.00876179+0.00167428j, -0.98973591+0.14262975j]]), array([[-0.97382200-0.22684101j, -0.01437382-0.00269481j],
       [ 0.01437382-0.00269481j, -0.97382200+0.22684101j]]), array([[-0.8670638-0.49626463j,  0.0435676+0.00486277j],
       [-0.0435676+0.00486277j, -0.8670638+0.49626463j]]), array([[-0.48024498 -8.77119578e-01j,  0.00509828 +1.17068612e-04j],
       [-0.00509828 +1.17068612e-04j, -0.48024498 +8.77119578e-01j]]), array([[ 0.14375751-0.98565666j,  0.01042592+0.08778401j],
       [-0.01042592+0.08778401j,  0.14375751+0.98565666j]]), array([[ 0.62557023 -7.80166025e-01j,  0.00165766 +3.44896109e-04j],
       [-0.00165766 +3.44896109e-04j,  0.62557023 +7.80166025e-01j]]), array([[ 0.91089031-0.41263672j, -0.00100123+0.00296375j],
       [ 0.00100123+0.00296375j,  0.91089031+0.41263672j]]), array([[ 0.99996283-0.00300278j, -0.00162107+0.0079176j ],
       [ 0.00162107+0.0079176j ,  0.99996283+0.00300278j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.99999999999999989, 0.0, 0.99999999999999989, 0.5, 0.5, 0.5, 0.5]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_res5(self):
        """ test gap_tol=None and move_tol=None"""
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                            num_strings=20,
                            pickle_file=None,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.4999877229169376, 0.5000122770830624], [0.49956475705501235, 0.50043524294498765], [0.4992387807325534, 0.50076121926744688], [0.49902825613107976, 0.50097174386892029], [0.49855386122808587, 0.50144613877191424], [0.49740259262205089, 0.50259740737794922], [0.49651104294287929, 0.50348895705712093], [0.49589349414615097, 0.5041065058538492], [0.49466965504030902, 0.50533034495969109], [0.49256858760975153, 0.50743141239024858], [0.49074703814921827, 0.50925296185078184], [0.48552226537253468, 0.51447773462746538], [0.47717727892234607, 0.52282272107765393], [0.46350315182712359, 0.53649684817287624], [0.41699779540947846, 0.58300220459052154], [0.32972611989658401, 0.67027388010341582], [0.22704073347978979, 0.77295926652021019], [0.14243318684650572, 0.85756681315349437], [0.067698120632063319, 0.93230187936793685], [0.0013721964517045919, 0.99862780354829539]], 'lambda_': [array([[ -9.99999997e-01 +7.11082504e-05j,
         -1.37682150e-05 +2.65425560e-05j],
       [  1.37682150e-05 +2.65425560e-05j,
         -9.99999997e-01 -7.11082504e-05j]]), array([[ -9.99996261e-01 -2.73433982e-03j,
          4.36274411e-05 -1.06730211e-05j],
       [ -4.36274411e-05 -1.06730211e-05j,
         -9.99996261e-01 +2.73433982e-03j]]), array([[ -9.99988562e-01-0.00477624j,  -7.48831845e-05+0.00024014j],
       [  7.48831845e-05+0.00024014j,  -9.99988562e-01+0.00477624j]]), array([[ -9.99981361e-01-0.00610168j,  -1.27593620e-04-0.00017792j],
       [  1.27593620e-04-0.00017792j,  -9.99981361e-01+0.00610168j]]), array([[ -9.99958719e-01-0.00907334j,  -2.23135474e-04+0.0004293j ],
       [  2.23135474e-04+0.0004293j ,  -9.99958719e-01+0.00907334j]]), array([[ -9.99866832e-01 -1.63131035e-02j,
         -4.46597646e-04 +4.11736696e-05j],
       [  4.46597646e-04 +4.11736696e-05j,
         -9.99866832e-01 +1.63131035e-02j]]), array([[ -9.99759728e-01-0.02190142j,  -8.67248757e-04-0.00024964j],
       [  8.67248757e-04-0.00024964j,  -9.99759728e-01+0.02190142j]]), array([[ -9.99667148e-01-0.02578765j,   7.19067833e-04-0.00026875j],
       [ -7.19067833e-04-0.00026875j,  -9.99667148e-01+0.02578765j]]), array([[ -9.99439211e-01 -3.34808440e-02j,
         -5.43139246e-04 -4.84772598e-05j],
       [  5.43139246e-04 -4.84772598e-05j,
         -9.99439211e-01 +3.34808440e-02j]]), array([[ -9.98910083e-01-0.0466721j ,   4.53354194e-04-0.00039512j],
       [ -4.53354194e-04-0.00039512j,  -9.98910083e-01+0.0466721j ]]), array([[-0.99831046-0.05796809j, -0.00355797+0.00180852j],
       [ 0.00355797+0.00180852j, -0.99831046+0.05796809j]]), array([[-0.99586542-0.09068864j, -0.00518335+0.00087717j],
       [ 0.00518335+0.00087717j, -0.99586542+0.09068864j]]), array([[-0.98973591-0.14262975j,  0.00876179+0.00167428j],
       [-0.00876179+0.00167428j, -0.98973591+0.14262975j]]), array([[-0.97382200-0.22684101j, -0.01437382-0.00269481j],
       [ 0.01437382-0.00269481j, -0.97382200+0.22684101j]]), array([[-0.8670638-0.49626463j,  0.0435676+0.00486277j],
       [-0.0435676+0.00486277j, -0.8670638+0.49626463j]]), array([[-0.48024498 -8.77119578e-01j,  0.00509828 +1.17068612e-04j],
       [-0.00509828 +1.17068612e-04j, -0.48024498 +8.77119578e-01j]]), array([[ 0.14375751-0.98565666j,  0.01042592+0.08778401j],
       [-0.01042592+0.08778401j,  0.14375751+0.98565666j]]), array([[ 0.62557023 -7.80166025e-01j,  0.00165766 +3.44896109e-04j],
       [-0.00165766 +3.44896109e-04j,  0.62557023 +7.80166025e-01j]]), array([[ 0.91089031-0.41263672j, -0.00100123+0.00296375j],
       [ 0.00100123+0.00296375j,  0.91089031+0.41263672j]]), array([[ 0.99996283-0.00300278j, -0.00162107+0.0079176j ],
       [ 0.00162107+0.0079176j ,  0.99996283+0.00300278j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.99999999999999989, 0.0, 0.99999999999999989, 0.5, 0.5, 0.5, 0.5]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_change_uc(self):
        """test chaning the unit cell"""
        self.create_model(0.1, 0.3)
        model = self.model.change_uc([[1, 1, 1], [0, 1, 1], [0, 0, 1]])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                            num_strings=20,
                            pickle_file=None,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.052631578947368418, 0.10526315789473684, 0.15789473684210525, 0.21052631578947367, 0.26315789473684209, 0.31578947368421051, 0.36842105263157893, 0.42105263157894735, 0.47368421052631576, 0.52631578947368418, 0.57894736842105265, 0.63157894736842102, 0.68421052631578938, 0.73684210526315785, 0.78947368421052633, 0.84210526315789469, 0.89473684210526305, 0.94736842105263153, 1.0], 'wcc': [[0.49988883094870729, 0.50011116905129283], [0.49975970789911733, 0.50024029210088283], [0.49920965900088243, 0.50079034099911757], [0.49826532903027704, 0.50173467096972302], [0.49826867499785349, 0.50173132500214646], [0.49759485929778108, 0.50240514070221909], [0.4965435023748106, 0.50345649762518951], [0.4956846273962644, 0.50431537260373571], [0.49472603316130997, 0.50527396683869008], [0.49251086450985482, 0.50748913549014507], [0.49041880976129332, 0.50958119023870685], [0.48598610125573688, 0.51401389874426329], [0.48000855268586079, 0.51999144731413938], [0.46143878988254117, 0.53856121011745905], [0.41742073155910758, 0.58257926844089236], [0.32721008750837638, 0.67278991249162368], [0.23313324212672654, 0.76686675787327352], [0.14582561429641483, 0.85417438570358528], [0.071361185328338836, 0.92863881467166121], [0.003132950898771943, 0.99686704910122814]], 'lambda_': [array([[ -9.99999756e-01 +6.96395766e-04j,
          2.37700158e-05 -4.86225907e-05j],
       [ -2.37700158e-05 -4.86225907e-05j,
         -9.99999756e-01 -6.96395766e-04j]]), array([[ -9.99998860e-01-0.0014431j ,  -1.91709354e-04+0.00040027j],
       [  1.91709354e-04+0.00040027j,  -9.99998860e-01+0.0014431j ]]), array([[ -9.99987670e-01 -4.96564605e-03j,
          1.08835002e-05 -4.23470605e-05j],
       [ -1.08835002e-05 -4.23470605e-05j,
         -9.99987670e-01 +4.96564605e-03j]]), array([[ -9.99940604e-01-0.01085614j,  -2.66139176e-04+0.00092868j],
       [  2.66139176e-04+0.00092868j,  -9.99940604e-01+0.01085614j]]), array([[ -9.99940833e-01 -1.08780213e-02j,
          1.77370304e-17 -3.16792643e-16j],
       [  4.14889782e-17 -1.71532639e-16j,
         -9.99940833e-01 +1.08780213e-02j]]), array([[ -9.99885817e-01-0.01511059j,  -1.21493713e-05+0.0001533j ],
       [  1.21493713e-05+0.0001533j ,  -9.99885817e-01+0.01511059j]]), array([[ -9.99764178e-01-0.02170328j,   3.52662797e-04-0.00065767j],
       [ -3.52662797e-04-0.00065767j,  -9.99764178e-01+0.02170328j]]), array([[ -9.99632430e-01-0.02706605j,  -1.04559185e-04+0.00155636j],
       [  1.04559185e-04+0.00155636j,  -9.99632430e-01+0.02706605j]]), array([[ -9.99451010e-01-0.03313101j,  -4.08358517e-05+0.00011808j],
       [  4.08358517e-05+0.00011808j,  -9.99451010e-01+0.03313101j]]), array([[ -9.98893088e-01-0.04687095j,  -9.60024016e-05+0.00396271j],
       [  9.60024016e-05+0.00396271j,  -9.98893088e-01+0.04687095j]]), array([[ -9.98188503e-01-0.05973303j,  -1.21310253e-05+0.0071886j ],
       [  1.21310253e-05+0.0071886j ,  -9.98188503e-01+0.05973303j]]), array([[ -9.96125933e-01-0.08793756j,  -3.12283251e-04-0.00011419j],
       [  3.12283251e-04-0.00011419j,  -9.96125933e-01+0.08793756j]]), array([[-0.99212144-0.12337637j, -0.00277606+0.0215783j ],
       [ 0.00277606+0.0215783j , -0.99212144+0.12337637j]]), array([[ -9.70791754e-01-0.23987034j,  -6.11746714e-05-0.00505829j],
       [  6.11746714e-05-0.00505829j,  -9.70791754e-01+0.23987034j]]), array([[ -8.68384639e-01 -4.95890977e-01j,
         -3.38577412e-04 -3.76797778e-04j],
       [  3.38577412e-04 -3.76797778e-04j,
         -8.68384639e-01 +4.95890977e-01j]]), array([[ -4.66319194e-01-0.88457289j,  -2.58148775e-04-0.00878357j],
       [  2.58148775e-04-0.00878357j,  -4.66319194e-01+0.88457289j]]), array([[ 0.10577870 -9.94389631e-01j,  0.00027477 +2.29519651e-04j],
       [-0.00027477 +2.29519651e-04j,  0.10577870 +9.94389631e-01j]]), array([[ 0.60879991-0.79306679j,  0.01222939+0.01606805j],
       [-0.01222939+0.01606805j,  0.60879991+0.79306679j]]), array([[ 0.90115249-0.43295926j,  0.02122333+0.00447614j],
       [-0.02122333+0.00447614j,  0.90115249+0.43295926j]]), array([[ 0.99980626+0.01520773j,  0.01248746-0.00048351j],
       [-0.01248746-0.00048351j,  0.99980626-0.01520773j]])], 'kpt': [[0.0, 0.0, 0], [0.026315789473684209, 0.0, 0], [0.052631578947368418, 0.0, 0], [0.078947368421052627, 0.0, 0], [0.10526315789473684, 0.0, 0], [0.13157894736842105, 0.0, 0], [0.15789473684210525, 0.0, 0], [0.18421052631578946, 0.0, 0], [0.21052631578947367, 0.0, 0], [0.23684210526315788, 0.0, 0], [0.26315789473684209, 0.0, 0], [0.28947368421052633, 0.0, 0], [0.31578947368421051, 0.0, 0], [0.34210526315789469, 0.0, 0], [0.36842105263157893, 0.0, 0], [0.39473684210526316, 0.0, 0], [0.42105263157894735, 0.0, 0], [0.44736842105263153, 0.0, 0], [0.47368421052631576, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.5, 0.5]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)
        
    def test_change_uc_error(self):
        """test chaning the unit cell"""
        self.create_model(0.1, 0.3)
        self.assertRaises(ValueError, self.model.change_uc, [[2, 1, 1], [0, 1, 1], [0, 0, 1]])

    def test_supercell1(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([1, 1, 2], [True, True, False])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                            num_strings=5,
                            pickle_file=None,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.25, 0.5, 0.75, 1.0], 'wcc': [[0.00018584652615086998, 0.00052654182330489155, 0.49983729149351097, 0.49992766447046344, 0.50007233704101006, 0.50016271052371564, 0.99947345666522158, 0.99981415145662278], [0.0012567391209597576, 0.0015966595399664865, 0.49942846806072111, 0.49997284753055693, 0.50002747987360063, 0.50057175100131068, 0.99840312139800147, 0.99874293347488285], [0.0028127432957232613, 0.0033960965756389136, 0.49812251588687217, 0.49882860235070065, 0.50117418070079101, 0.50187950742987131, 0.99660188010761752, 0.99718447365278529], [0.0021036914741925194, 0.0045383598779368227, 0.49719681272509214, 0.49802383207652762, 0.5020086078846796, 0.50271981245510622, 0.9955450149418652, 0.9978638685646003], [0.000237878366083796, 0.00028987264113964722, 0.4987636192452144, 0.49876916183511777, 0.50123037585975172, 0.50123596090847256, 0.99971054720517338, 0.99976258393904649]], 'lambda_': [array([[  9.99994427e-01 -3.04990367e-03j,
         -1.17251260e-03 -5.18187277e-04j,
          3.60658180e-04 -2.52847819e-04j,
          7.11393403e-05 +2.75976820e-05j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  1.17250681e-03 -5.18180999e-04j,
          9.99994427e-01 +3.04991316e-03j,
          7.41540311e-05 -4.50224262e-05j,
         -3.53262046e-04 -2.60196516e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  3.61645373e-04 +2.51595207e-04j,
          7.37558733e-05 +4.48049788e-05j,
         -9.99999796e-01 +4.23587771e-04j,
         -7.29167753e-05 +1.47754373e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  7.07978115e-05 -2.73681578e-05j,
         -3.54259881e-04 +2.58948973e-04j,
          7.29209713e-05 +1.47761632e-04j,
         -9.99999798e-01 -4.23578272e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          9.99999188e-01 -1.07724582e-03j,
          2.43508948e-04 -3.79197959e-04j,
          4.52469525e-04 +9.87950027e-05j,
         -1.27537383e-04 +1.73758432e-04j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -2.43509433e-04 -3.79188458e-04j,
          9.99999191e-01 +1.07725850e-03j,
         -1.16439784e-04 -1.91381355e-04j,
         -4.43210885e-04 +8.95889243e-05j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          4.52548238e-04 -9.88413949e-05j,
         -1.16815960e-04 +1.90938457e-04j,
         -9.99999345e-01 -1.01663472e-03j,
         -1.06730523e-04 +1.47169736e-05j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.27876525e-04 -1.73297243e-04j,
         -4.43287091e-04 -8.96283056e-05j,
          1.06724448e-04 +1.47210118e-05j,
         -9.99999352e-01 +1.01664740e-03j]]), array([[  9.94441492e-01 +5.97601318e-03j,
          4.00034619e-02 -9.70737084e-02j,
         -2.77091449e-03 +4.31473256e-03j,
         -4.22695357e-04 +5.91981110e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  3.94093950e-02 +9.73109762e-02j,
         -9.94472544e-01 -6.15304497e-05j,
         -1.32359193e-03 +2.16972031e-04j,
          1.61440136e-04 -5.61319607e-05j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  2.75488033e-03 +4.33123046e-03j,
         -8.05301161e-04 -3.19016041e-04j,
          9.94441248e-01 -5.97401225e-03j,
         -9.69302418e-02 -4.03527531e-02j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -8.62540505e-04 -8.86801668e-04j,
         -1.44791087e-04 -4.02674943e-05j,
         -9.66786455e-02 +4.09397278e-02j,
         -9.94472534e-01 +6.36437431e-05j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          9.94491211e-01 +5.09439162e-03j,
          3.94362767e-02 -9.65816492e-02j,
         -7.80485529e-03 +3.66700378e-03j,
         -5.57501084e-04 -1.83552558e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          3.91656581e-02 +9.66786343e-02j,
         -9.94534979e-01 +2.21162818e-03j,
          4.81603537e-04 -2.53328053e-03j,
          2.80728226e-04 -2.80170729e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          7.78563395e-03 +3.63614925e-03j,
          1.24495461e-03 +1.63195539e-03j,
          9.94491742e-01 -5.09288423e-03j,
         -9.61723978e-02 -4.04110982e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.73309356e-03 +1.93109511e-03j,
         -3.11329173e-04 -2.78207360e-03j,
         -9.60467203e-02 +4.06725117e-02j,
         -9.94535730e-01 -2.21038283e-03j]]), array([[  9.70090880e-01 -1.47567141e-02j,
         -5.52489840e-04 -2.42119437e-01j,
         -8.66476291e-03 +2.92252670e-03j,
          8.07803160e-05 +4.13276022e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  4.58938460e-03 +2.42072040e-01j,
         -9.70219967e-01 +5.83906379e-03j,
         -1.72943232e-04 -1.58029471e-03j,
          3.82080244e-03 +1.43534497e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  8.63368241e-03 +2.91584648e-03j,
         -3.84296531e-04 -2.04781292e-04j,
          9.70088552e-01 +1.47742144e-02j,
         -2.42128715e-01 -6.13639479e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -1.70459401e-03 -2.00388930e-04j,
         -3.82811562e-03 +1.46631197e-03j,
         -2.42081129e-01 -4.52810475e-03j,
         -9.70217801e-01 -5.82159450e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          9.70098560e-01 -1.85023813e-02j,
         -1.27483709e-03 -2.41802720e-01j,
         -8.99295265e-03 +3.81350207e-03j,
         -3.13927262e-04 +8.66708536e-04j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          5.85435151e-03 +2.41730600e-01j,
         -9.70256751e-01 +1.01056836e-02j,
         -6.44287149e-04 -1.69054788e-03j,
          4.75418649e-03 +2.42480050e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          8.93501051e-03 +3.81270554e-03j,
         -8.60043597e-04 +8.15776913e-05j,
          9.70094923e-01 +1.85150683e-02j,
         -2.41818304e-01 -1.35028889e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.92305181e-03 -6.48566908e-04j,
         -4.75612357e-03 +2.48269796e-03j,
         -2.41745622e-01 -5.77908855e-03j,
         -9.70253001e-01 -1.00929487e-02j]]), array([[ 0.91492878-0.00898086j, -0.16559773-0.36485885j,
         0.00598699-0.00701894j, -0.03220478+0.03402691j,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ],
       [-0.15986722+0.36799327j, -0.91484097+0.00723319j,
        -0.00485511-0.04388954j, -0.00687880+0.0063185j ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ],
       [-0.00543744-0.00621484j, -0.00267709+0.04868739j,
         0.91493920+0.00919084j, -0.37550583+0.13910913j,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ],
       [-0.02725761-0.03220145j,  0.00764377+0.00574771j,
        -0.37368480-0.14534956j, -0.91504771-0.00703555j,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
         0.91844408-0.02652259j, -0.15576200-0.3596176j ,
         0.00210019+0.00161117j, -0.03647600+0.02886003j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
        -0.13930854+0.36637236j, -0.91871471+0.01424672j,
         0.00612742-0.04532155j,  0.00543515-0.00189944j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
        -0.00228518+0.00202807j,  0.00426245+0.04612386j,
         0.91860805+0.02600264j, -0.36428502+0.14361279j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,
        -0.03721849-0.02696099j, -0.00502960-0.00167994j,
        -0.35746086-0.16001955j, -0.91883457-0.0147742j ]]), array([[  8.68408853e-01 -9.50996464e-04j,
         -3.51083826e-01 -3.45053816e-01j,
          3.88022075e-04 +1.98654749e-04j,
         -4.51229481e-02 +3.88188100e-02j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -3.48124392e-01 +3.48095596e-01j,
         -8.68502891e-01 +6.06349892e-03j,
          4.46930842e-02 -3.59536319e-02j,
          3.80365697e-03 -4.71684080e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -1.44270427e-03 +1.84754513e-04j,
          4.38362432e-02 +3.75170229e-02j,
          8.68388662e-01 +9.49535614e-04j,
         -3.51274567e-01 +3.45217540e-01j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -4.59710166e-02 -3.72635647e-02j,
         -3.81156549e-03 +5.49347651e-04j,
         -3.48320449e-01 -3.48256758e-01j,
         -8.68237609e-01 -6.06731393e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          8.65998989e-01 +1.70117277e-04j,
         -3.52634954e-01 -3.49305275e-01j,
          6.34185402e-04 +7.37294778e-05j,
         -4.53937296e-02 +4.02385242e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -3.50177926e-01 +3.51809836e-01j,
         -8.66150501e-01 +5.77733823e-03j,
          4.45326802e-02 -3.67675720e-02j,
          4.28747865e-03 -1.33982336e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -2.16720816e-03 +1.43527446e-04j,
          4.34357571e-02 +3.84691190e-02j,
          8.65996948e-01 -1.70638606e-04j,
         -3.52862270e-01 +3.49522847e-01j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -4.64767469e-02 -3.85509639e-02j,
         -4.21734331e-03 +1.49671083e-04j,
         -3.50417576e-01 -3.52024656e-01j,
         -8.65787879e-01 -5.78262631e-03j]])], 'kpt': [[0.0, 0.0, 0], [0.125, 0.0, 0], [0.25, 0.0, 0], [0.375, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.25018191665840794, 0.25051256380034381, 0.25075930623125553, 0.74913241369848571, 0.75047325405682297]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)
        
    def test_supercell2(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([1, 1, 3], [True, True, True])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                            num_strings=5,
                            pickle_file=None,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.25, 0.5, 0.75, 1.0], 'wcc': [[0.0024313748823754288, 0.018729032092920938, 0.4629879627671834, 0.49792999365082041, 0.49963599788463853, 0.50036403223327519, 0.500460673579596, 0.50197810415392996, 0.6219313603112977, 0.99756859499971073], [0.0010795936111971495, 0.15734101185227647, 0.46855217487104239, 0.49071360640845013, 0.499608316607908, 0.50039359912973058, 0.50177722340028508, 0.50584737092422083, 0.56409236864909218, 0.99891849065116411], [0.0040805590065549025, 0.18922577987347833, 0.41749127872892261, 0.47247057732904141, 0.47909114816032011, 0.49931686904851391, 0.50674632615165494, 0.52675061104583421, 0.58541741340100817, 0.84651813298882572], [0.18118880702904125, 0.2827058484637377, 0.37906121343253735, 0.47260458633024027, 0.49856787486411214, 0.55396952689283607, 0.65646463245209619, 0.69851677306339011, 0.84323699000959706, 0.99855244798293552], [0.0019343460661669844, 0.043743551586803965, 0.24943920476137485, 0.33938580525926737, 0.49714089703892272, 0.50454276012863863, 0.66518903398845841, 0.78859239714997342, 0.9387137744543097, 0.98405331897607262]], 'lambda_': [array([[  9.99873516e-01 +1.48573302e-02j,
         -3.08533253e-03 -1.76227307e-03j,
         -2.95455607e-03 +3.01449808e-03j,
          1.12645665e-03 -7.08060618e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  3.08526329e-03 -1.76264106e-03j,
          9.99873629e-01 -1.48571411e-02j,
          1.04781216e-03 +6.66682396e-04j,
          2.93722598e-03 +3.03246926e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -2.91391573e-03 -3.05483503e-03j,
          1.04458165e-03 -6.66754895e-04j,
         -9.99987705e-01 +1.93000020e-03j,
         -1.90601394e-04 -1.21276749e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  1.12241637e-03 +7.09397167e-04j,
          2.89614896e-03 -3.07294975e-03j,
          1.90237749e-04 -1.21268393e-03j,
         -9.99987588e-01 -1.92981087e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          8.22123003e-01 -5.81870846e-02j,
         -2.16534408e-01 -4.46963411e-01j,
         -4.16089228e-02 +7.76216370e-02j,
          1.56582198e-02 +9.70260951e-02j,
          1.63567817e-01 +1.19057319e-01j,
         -4.07167971e-02 +1.18583276e-01j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          1.45878930e-01 +4.42690595e-01j,
         -6.46666312e-01 +4.50764624e-01j,
         -2.19348529e-01 -9.63390671e-02j,
          1.06344396e-01 -2.95450620e-01j,
         -9.10287084e-03 +1.50398332e-02j,
         -1.46327427e-02 -6.97132823e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.13231999e-01 -1.59399855e-01j,
          8.70286858e-02 -1.42634316e-01j,
         -9.65319016e-01 -9.54854153e-03j,
          2.33104528e-02 +2.25734941e-02j,
         -2.14291268e-03 -1.83249518e-02j,
          2.27113274e-02 +3.24698044e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -1.20991234e-01 -1.28808959e-04j,
         -2.61548716e-01 -1.52766617e-01j,
         -9.27558775e-03 -5.16333657e-02j,
         -9.42898408e-01 -3.50886945e-02j,
         -3.93096962e-03 -8.53434909e-03j,
          1.95772853e-02 -1.01740547e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          1.38877452e-01 -1.21594196e-01j,
         -7.33134491e-02 -4.23458118e-02j,
          5.97599564e-03 +4.26067145e-03j,
          1.26835774e-02 +7.70941926e-03j,
         -9.78832305e-01 +1.02302032e-02j,
          2.67969812e-03 +1.61611066e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -8.02725354e-02 -1.00438721e-01j,
         -6.96838430e-02 -1.68141732e-02j,
         -5.99128368e-04 -1.05044274e-02j,
          1.27515896e-02 -4.01026571e-03j,
          4.13631163e-03 -9.93647021e-03j,
         -9.88846220e-01 -1.03804036e-02j]]), array([[  9.94259251e-01 -2.34782681e-03j,
          4.00699508e-02 -9.89421813e-02j,
          6.35170032e-03 +1.79507399e-04j,
         -8.80894359e-04 +2.59266816e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  4.02668462e-02 +9.88577250e-02j,
         -9.94279864e-01 -5.66124487e-04j,
         -2.16276292e-03 +1.56528343e-03j,
         -6.88920390e-04 -2.31518751e-03j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -6.35293560e-03 +1.54408904e-04j,
         -2.23520043e-03 -1.13369835e-03j,
          9.94261705e-01 +2.35981468e-03j,
         -9.82636444e-02 -4.16615560e-02j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [ -5.25359942e-04 -2.84641648e-03j,
          6.63797731e-04 -2.31362057e-03j,
         -9.83438006e-02 +4.14618739e-02j,
         -9.94281099e-01 +5.78210168e-04j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          5.26544966e-02 -4.80393607e-01j,
         -8.49848846e-02 -1.29757112e-01j,
         -1.67191978e-01 +8.17282575e-01j,
         -2.29397899e-02 -1.74010296e-01j,
         -4.79877521e-02 -7.08581110e-02j,
          6.65037884e-02 -6.27209343e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          2.68434815e-01 +2.23410081e-01j,
         -9.35055534e-01 -4.84285186e-02j,
          2.68536011e-02 +1.39107072e-02j,
          1.02292102e-02 -6.01656497e-03j,
          2.32261666e-03 -3.59416925e-03j,
         -1.42860354e-02 -8.86848811e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -7.86448805e-01 -1.06280686e-01j,
         -2.76520636e-01 +1.46378466e-01j,
         -4.97212425e-01 -1.28684367e-01j,
         -2.66032755e-02 -2.85871497e-02j,
          5.51020989e-03 -3.36362343e-03j,
          7.30711353e-02 +4.03297318e-02j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          1.09782661e-01 +1.54667331e-03j,
          1.81832232e-02 -3.07658288e-02j,
         -1.28706968e-01 -5.74725125e-02j,
         -9.82909736e-01 +2.34107226e-02j,
         -4.42989981e-03 +4.92688429e-05j,
         -1.09701548e-02 -2.33040949e-04j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          2.55718784e-02 +2.61021074e-02j,
          9.37423858e-03 -2.70421811e-03j,
         -4.94448615e-02 -5.77459910e-02j,
          1.76556170e-02 +7.75306408e-03j,
         -9.94515405e-01 -5.75325020e-02j,
          1.46233789e-03 -6.73253952e-03j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
         -3.57532716e-02 -3.83441959e-03j,
          1.85366155e-03 +6.16997046e-04j,
         -1.01084209e-01 +5.94606156e-02j,
          1.64702626e-02 -1.50225311e-02j,
         -1.25264956e-04 -1.50264070e-02j,
         -9.91211546e-01 +4.15514034e-02j]]), array([[  9.55057272e-01 -1.08069677e-02j,
         -6.12349323e-03 -2.46319634e-01j,
         -1.17195618e-01 -4.93376517e-03j,
          4.07514423e-03 -4.00580992e-02j,
          7.86484212e-03 +9.64320141e-02j,
         -1.45344620e-02 +1.64504120e-02j,
          3.46954505e-02 +1.72740913e-02j,
          2.13517651e-03 +3.78692583e-03j,
         -5.15359258e-03 +6.78267262e-04j,
          2.44517311e-03 +1.61438099e-02j],
       [  6.63200117e-03 +2.43706437e-01j,
         -9.67547162e-01 +1.95929719e-03j,
          3.88194197e-02 -3.07490108e-02j,
          4.62130617e-03 +2.08448266e-02j,
         -1.46228637e-02 -3.15198610e-02j,
          2.85552187e-03 -7.34809839e-03j,
         -1.38365750e-02 -1.51352839e-03j,
         -1.18969212e-03 -1.01105139e-03j,
          1.65248265e-03 -8.68411359e-04j,
         -2.82832567e-03 -5.13667118e-03j],
       [  8.38320913e-02 +5.43360992e-02j,
          3.20356274e-02 +1.29731017e-02j,
          9.41601008e-02 -8.41965124e-02j,
         -1.95951582e-01 -3.10632989e-01j,
          4.59424940e-01 -6.79577341e-01j,
          1.83388779e-01 -3.17271099e-02j,
         -1.37881514e-01 -2.98277008e-01j,
          5.96132989e-03 -3.63735782e-02j,
          3.76865714e-02 +2.28466952e-02j,
          6.94482309e-02 -1.19754230e-01j],
       [ -3.51406989e-02 +1.77212780e-02j,
         -5.41540330e-03 +1.53556082e-02j,
         -3.70946034e-02 -3.06027393e-01j,
         -8.65056556e-01 +7.73016863e-02j,
          1.61988953e-01 +3.05438933e-01j,
         -2.44807041e-02 +7.45238162e-02j,
          1.38283088e-01 +7.70983538e-03j,
          1.23564018e-02 +9.41576027e-03j,
         -1.59592482e-02 +9.50387000e-03j,
          3.08231955e-02 +4.95403591e-02j],
       [  9.11142017e-03 +1.49395086e-02j,
          2.32679274e-03 +5.02026773e-03j,
          5.04961708e-02 +1.15648774e-01j,
         -4.16590302e-02 +1.57610649e-02j,
         -3.62573855e-01 -2.47974643e-02j,
          4.51593495e-02 +5.29885404e-02j,
          4.51535121e-01 -6.94521339e-01j,
          3.51062417e-01 +1.78890636e-01j,
          2.05669486e-02 +5.35135456e-02j,
          7.38900683e-03 -1.04351939e-03j],
       [ -1.61650658e-03 +4.49641217e-02j,
         -2.12027693e-03 +1.40683658e-02j,
         -5.55051028e-02 +3.19685391e-01j,
         -1.11716177e-01 -2.52051586e-02j,
          1.29467656e-01 -8.57695172e-02j,
         -9.03337928e-01 -1.28783290e-01j,
         -6.70040009e-02 -1.22844217e-01j,
         -6.30069647e-03 -6.21015434e-03j,
          9.30963507e-05 +2.58180673e-02j,
          2.74164318e-02 +3.97272397e-02j],
       [  1.02782502e-02 -1.14402955e-01j,
          7.33161615e-03 -3.55732843e-02j,
          1.85273529e-01 -8.07353789e-01j,
          2.81339706e-01 +7.95524034e-02j,
          7.62594099e-03 -4.30178079e-02j,
         -3.41082285e-01 -5.27777581e-02j,
          1.50623718e-01 -7.76010125e-02j,
          2.61449849e-02 -5.39478216e-02j,
          4.08213605e-02 -1.17239058e-01j,
         -9.07637705e-03 -2.12206646e-01j],
       [  1.38600132e-02 +5.35155661e-04j,
          4.33519596e-03 +6.65151634e-04j,
          9.85057146e-02 +1.73726905e-02j,
         -7.86163010e-03 +3.44187168e-02j,
         -9.76201014e-02 +8.36819107e-02j,
          3.12402709e-02 -9.13923068e-03j,
          4.13123126e-02 -3.60550091e-01j,
         -9.14256588e-01 +5.33785763e-02j,
          2.14238535e-02 -6.88549544e-03j,
          3.58132743e-03 -2.87022993e-03j],
       [  1.75911517e-02 -1.19876369e-03j,
          5.56958270e-03 +2.54207121e-04j,
          1.26859464e-01 +8.63137694e-03j,
         -5.28024985e-03 +4.45681294e-02j,
          1.91375414e-03 -2.93485580e-02j,
          4.63154821e-03 -2.69716609e-02j,
         -1.99043072e-02 -4.42193332e-02j,
          6.90883279e-03 -2.06057904e-02j,
         -9.78000031e-01 -1.43215919e-01j,
          1.59294708e-03 -6.38945552e-03j],
       [  2.74431614e-02 +1.48085979e-03j,
          8.56868719e-03 +1.44935645e-03j,
          1.94631911e-01 +3.74080691e-02j,
         -1.66199388e-02 +6.79516442e-02j,
          1.45835467e-01 -1.53188144e-02j,
          2.83112411e-03 -1.65557611e-02j,
          4.39274550e-02 -2.49841585e-02j,
          1.64803340e-02 +1.25128066e-03j,
          2.72064624e-02 +8.72479154e-03j,
         -9.56276709e-01 +1.22887559e-01j]]), array([[  8.90559470e-01 +1.42799043e-03j,
         -1.61034800e-01 -3.81456696e-01j,
         -1.13565147e-01 -1.26850811e-02j,
         -1.07980780e-01 -2.49763232e-02j,
         -8.56068391e-02 -3.85045870e-02j,
         -1.16828830e-02 +1.95110785e-02j,
          2.13117986e-02 -1.65432990e-02j,
          3.93966275e-03 -1.30415506e-03j,
          2.81631065e-03 -6.67064658e-05j,
          3.81175108e-03 -4.78408205e-03j],
       [ -1.51222498e-01 +3.70204167e-01j,
         -9.06581974e-01 -1.03463041e-02j,
          2.58557824e-02 -4.27579082e-02j,
          4.12489368e-02 -1.04299990e-02j,
          1.12792549e-01 -2.56864692e-02j,
         -4.62014091e-03 -7.21502737e-03j,
         -8.73668508e-03 +1.42658512e-02j,
         -1.67685647e-04 +1.53911456e-03j,
         -3.02819547e-03 +2.33813054e-03j,
          9.06853849e-04 +4.75732023e-03j],
       [ -1.00631433e-01 +4.44687074e-02j,
          8.97740436e-03 +1.97638497e-02j,
         -3.99221352e-01 +3.83070260e-01j,
         -6.26603212e-01 -7.68006159e-02j,
          2.83122832e-01 +2.23613557e-02j,
         -3.31501791e-01 +1.20745964e-01j,
          2.38801087e-01 -1.16859991e-01j,
          6.08939361e-02 +2.35809267e-02j,
         -1.40253195e-02 +5.84942648e-05j,
          4.96029454e-02 +6.25354814e-03j],
       [ -7.86778858e-03 -4.49558301e-02j,
          1.49046853e-02 +1.20344335e-02j,
          2.51327399e-01 -4.71524342e-01j,
         -6.67640629e-01 +1.40698172e-01j,
          2.19175353e-01 -5.56119219e-02j,
          2.42579006e-01 -2.00588948e-01j,
         -2.19409902e-01 +2.06177170e-01j,
         -5.79543374e-02 -1.73340191e-03j,
         -6.75467667e-04 +6.42208744e-03j,
         -4.07007137e-02 +2.42638043e-02j],
       [ -2.23714356e-02 -1.03288339e-01j,
         -1.02516528e-02 -3.43537214e-02j,
          2.79717997e-01 -2.16671661e-01j,
         -5.92417459e-04 -1.60856284e-01j,
          1.97235592e-02 -4.54086447e-01j,
         -2.85207082e-01 -8.65887880e-02j,
          4.22254426e-01 -3.19028223e-01j,
         -2.89670841e-01 -2.62151436e-01j,
          2.35327102e-01 -7.41947995e-02j,
         -1.31832028e-01 +1.73447132e-01j],
       [  3.24603691e-03 +3.03130260e-02j,
         -6.06122227e-03 -9.73356544e-03j,
          3.32034706e-02 +3.72892431e-01j,
         -2.89690634e-02 -4.09217653e-02j,
         -1.24388290e-01 -1.27731320e-01j,
         -3.18028737e-01 -3.96030166e-01j,
         -4.46444320e-01 +1.99022457e-01j,
         -4.90263159e-01 +7.62212838e-02j,
          6.78272880e-02 +5.09696617e-02j,
         -2.29917797e-01 -1.46128042e-01j],
       [ -7.09304230e-02 +7.02108616e-03j,
         -1.45531809e-02 -1.58554473e-02j,
         -2.77366001e-01 +1.12403421e-01j,
         -5.98242619e-02 -9.19317384e-02j,
         -1.22965644e-01 -1.98344488e-01j,
          5.74997708e-01 +2.67119147e-01j,
          2.27058133e-01 +2.06638351e-01j,
         -2.97836321e-01 +1.59820822e-01j,
          2.61478380e-01 +3.31528682e-02j,
         -3.98028113e-01 -4.80397795e-03j],
       [  9.31137180e-02 -6.32017022e-03j,
          3.65437268e-02 +1.86675440e-02j,
          7.79809677e-02 -9.92019421e-02j,
          1.51845597e-01 +1.19842481e-01j,
          4.52097146e-01 +2.72203230e-01j,
          4.87968892e-02 -5.28427345e-02j,
          2.17234361e-01 -2.95584950e-01j,
         -4.46897253e-01 +4.59358221e-01j,
         -1.68226371e-01 +1.33956332e-01j,
          1.01964519e-03 -2.47125228e-01j],
       [  1.34791284e-02 -5.01877440e-02j,
          1.56408429e-02 -2.22997894e-02j,
         -2.76893375e-02 +4.34626275e-02j,
          9.01704674e-02 -8.56288716e-02j,
          2.17629271e-01 -2.58266082e-01j,
          4.42237236e-02 +4.60720256e-02j,
         -5.91104783e-03 +1.41843410e-01j,
         -2.24612629e-02 -2.47505211e-02j,
         -5.88667358e-01 -6.78511329e-01j,
         -1.74509192e-01 -4.08007715e-02j],
       [  5.24605189e-02 +3.81291472e-02j,
          2.44926626e-02 +2.85798069e-02j,
         -1.25612886e-01 -5.96768289e-02j,
          8.23546916e-02 +1.47486515e-01j,
          2.01944070e-01 +3.46199041e-01j,
         -7.88046941e-02 +1.07684676e-01j,
         -2.12515817e-01 -1.56609573e-01j,
         -5.36605935e-02 -2.54128835e-01j,
         -6.09898046e-02 +7.29091905e-02j,
         -5.67971851e-01 +5.47068131e-01j]]), array([[  8.73627684e-01 -1.29440640e-02j,
         -3.36055798e-01 -3.32901886e-01j,
          3.36329962e-02 +4.56508930e-02j,
         -4.61752805e-02 +3.00854637e-02j,
         -5.03428983e-02 +1.09232509e-02j,
          3.39019604e-02 -2.71955599e-02j,
         -1.44530490e-02 -1.12151600e-02j,
         -1.92538844e-02 +3.53537776e-02j,
         -6.89162908e-03 +3.85487997e-04j,
          7.09590438e-03 +1.24427439e-03j],
       [ -3.33959400e-01 +3.40851943e-01j,
         -8.77947989e-01 +1.55582015e-03j,
         -1.49129804e-02 +6.05216226e-03j,
          3.26495677e-04 +2.74100031e-02j,
         -1.68520588e-02 +1.29200028e-02j,
          1.61448940e-03 +2.05386142e-03j,
         -1.91715605e-03 -1.07135728e-03j,
         -2.79452356e-03 +2.16843776e-04j,
          2.35886938e-03 -1.57361550e-03j,
         -1.03548606e-03 -2.45048025e-03j],
       [ -3.43917959e-02 +1.75121374e-02j,
          9.07730969e-03 +1.77906607e-02j,
          8.28218490e-03 -7.62025781e-02j,
         -1.45232435e-01 -2.25018484e-01j,
         -1.57410088e-01 -3.12832330e-01j,
          3.44491010e-02 -6.16490491e-01j,
         -2.63321901e-01 +5.43193234e-03j,
          1.90616781e-01 +5.38376375e-01j,
         -6.01723395e-02 +7.94372828e-02j,
          8.37508327e-02 -6.42195337e-02j],
       [ -9.04728454e-03 +1.26682850e-02j,
         -2.66466959e-03 +1.14903572e-02j,
          1.36069649e-01 -1.75272331e-01j,
         -7.71259193e-01 -2.30167011e-02j,
          5.27983548e-01 +2.51259285e-01j,
          4.84076750e-02 -2.10512198e-02j,
          2.70069731e-03 +3.33572380e-02j,
         -1.88547964e-03 +4.21241964e-02j,
         -4.41984958e-02 -4.40811675e-02j,
         -4.55965175e-02 +3.81401182e-02j],
       [ -8.01315068e-05 -6.99432771e-03j,
          2.59497790e-03 +9.41287898e-03j,
         -3.96250933e-02 +2.74117526e-02j,
         -1.06647530e-01 +3.66752014e-02j,
          3.32507655e-02 -3.43578408e-02j,
         -1.55823902e-01 +1.14231420e-01j,
         -2.60264903e-01 -3.49623075e-01j,
         -1.95219310e-01 +2.70874724e-02j,
          5.94699244e-01 +1.28332433e-01j,
          1.18952068e-01 -5.76276856e-01j],
       [  4.70384250e-02 -1.80550884e-03j,
         -1.72249038e-02 -2.11779650e-03j,
         -4.19283641e-01 -7.36642733e-01j,
          2.90677442e-02 -1.39136843e-01j,
         -1.26455825e-01 +4.07375115e-02j,
          2.92304349e-01 +1.34723166e-01j,
          1.71527953e-01 +3.78603930e-02j,
          1.57983370e-01 -2.53894923e-02j,
         -2.96943182e-02 +2.72907756e-02j,
         -6.19123534e-02 -2.75093764e-01j],
       [  7.99535744e-03 +3.38221050e-03j,
         -4.34087287e-03 +2.84846789e-03j,
          6.06317500e-02 -2.48924304e-01j,
         -2.02088756e-02 -3.47838316e-02j,
         -9.65578708e-02 -7.11145948e-02j,
         -2.89233691e-01 -4.78853441e-01j,
          1.52242501e-01 +1.83311404e-01j,
         -6.03984689e-01 -3.34787477e-01j,
         -1.49714980e-02 -2.20708926e-01j,
         -1.03415203e-01 -1.09590615e-01j],
       [  3.88008072e-02 -5.60364827e-02j,
         -6.29872946e-02 +2.27383096e-02j,
         -1.20993945e-01 +7.73377186e-02j,
         -1.61979002e-01 -5.17911973e-01j,
          1.49393096e-01 -6.76706367e-01j,
         -1.98471993e-01 +3.09011199e-01j,
          4.20925796e-02 +6.30320219e-02j,
          5.14967061e-02 -1.95619571e-01j,
          1.90424478e-02 -6.93346568e-02j,
         -3.68062000e-02 +8.63834548e-02j],
       [ -1.42775760e-03 -2.93266251e-03j,
         -1.58137834e-04 +2.88281005e-04j,
         -4.46802267e-02 +7.45380456e-02j,
         -3.46236415e-03 -4.87350629e-03j,
          1.85284876e-02 -6.65924688e-03j,
          1.27731647e-01 -3.50270603e-02j,
          4.57190174e-01 +4.75268849e-01j,
         -5.35861927e-02 +2.72866205e-01j,
          6.42569041e-01 +7.73101513e-02j,
          6.68075249e-02 +1.97244760e-01j],
       [  7.82193009e-03 -1.04310639e-02j,
          8.58250382e-04 +9.79325593e-04j,
         -3.55889805e-01 -1.34986016e-02j,
         -7.64433761e-03 +3.12175405e-03j,
          2.41322980e-02 +1.29685286e-01j,
         -4.17561779e-02 +7.76324360e-02j,
         -3.74650826e-01 +2.65614325e-01j,
         -1.03797915e-01 -7.83834958e-03j,
         -1.21041171e-02 -3.75804334e-01j,
          6.83204993e-01 +1.33623451e-01j]])], 'kpt': [[0.0, 0.0, 0], [0.125, 0.0, 0], [0.25, 0.0, 0], [0.375, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.24085849743005217, 0.78150542965012815, 0.715967773194917, 0.089870627505988399, 0.1465913781740894]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)
        
    def test_supercell3(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([2, 1, 3], [True, True, True])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                            num_strings=5,
                            pickle_file=None,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.25, 0.5, 0.75, 1.0], 'wcc': [[0.024898821638441364, 0.041571788691556526, 0.085790295337501446, 0.47112804345977677, 0.48146024819527877, 0.49130851360709937, 0.50977958526186495, 0.51511257574012603, 0.53121103373585354, 0.9160109890323902, 0.94648908191945946, 0.98523902338065017], [0.16735469289255242, 0.18842203292762227, 0.22891175598839181, 0.46508567619874464, 0.49050771649208158, 0.50001766473099796, 0.50082669354542042, 0.51775537271617178, 0.52580687631658296, 0.74236243741675112, 0.81407160211535878, 0.85887747865932373], [0.2769639177083697, 0.35500967881430739, 0.42811297350873539, 0.46876004456644321, 0.48282327237595396, 0.49077278940602725, 0.50415176708193354, 0.52075171970289813, 0.53274040686674273, 0.61263001413419316, 0.62538038755004766, 0.70190302828434636], [0.37582474981984948, 0.43687734224253538, 0.4676907224691888, 0.47388571845380578, 0.47909562180105869, 0.48925678692151503, 0.50753742085223341, 0.52265411716188526, 0.53376533079411903, 0.54225402773323839, 0.5679915330871107, 0.60316662866345938], [0.27836323648981387, 0.34241487602859905, 0.3717094279918301, 0.41379270723775874, 0.44660767385275962, 0.47868629137715218, 0.51217236870701832, 0.52865134271327885, 0.55310254199449016, 0.61591247370541802, 0.70631634227944629, 0.75227071762243369]], 'lambda_': [array([[  9.76322430e-01 +3.47860190e-02j,
          8.63936985e-03 -9.01342694e-02j,
         -9.30777345e-02 -4.35655515e-02j,
         -5.86845164e-02 +1.45187059e-02j,
         -4.63033633e-02 +8.83613121e-02j,
         -6.89177205e-02 -9.20225943e-02j,
          6.42325937e-16 +4.30390278e-16j,
         -5.44076892e-16 +9.34189523e-17j,
         -7.17441775e-16 +3.14338934e-16j,
          4.82671815e-17 +5.65930532e-16j,
          6.21181100e-16 +1.01135546e-15j,
          6.45634641e-16 +5.90210886e-16j],
       [  2.14249838e-02 -7.90757863e-02j,
          9.27728777e-01 -1.11976968e-01j,
          8.08293879e-02 -1.38860352e-02j,
          1.10276390e-01 +2.42893351e-01j,
          4.13911298e-02 -1.89137594e-01j,
          4.91894537e-02 +4.77318881e-02j,
          2.47064362e-15 -7.43001201e-16j,
         -1.12062191e-15 +1.07334555e-15j,
          9.25193510e-16 +9.50374562e-16j,
         -4.72246330e-16 +2.58739489e-15j,
         -2.17537521e-15 -2.56359305e-16j,
          1.12625664e-15 -9.49146269e-17j],
       [  1.06521153e-01 -2.72904308e-02j,
         -1.07460194e-01 +8.02673506e-03j,
          9.63074835e-01 -4.74386022e-02j,
          1.07359301e-01 -5.74409573e-02j,
          1.24155672e-01 -1.04019495e-01j,
         -5.73907049e-02 -4.66790433e-02j,
          1.92882837e-15 -8.82433063e-17j,
         -2.45765424e-15 -6.83448840e-16j,
          5.51876767e-16 -2.38545141e-16j,
         -1.78876158e-17 +2.80215924e-16j,
         -3.58791645e-16 +4.15757601e-16j,
         -3.90953470e-16 -7.06503173e-16j],
       [  1.05362462e-01 +1.71359859e-02j,
         -1.13583415e-01 +2.50899217e-01j,
         -9.68460338e-02 -1.34673811e-02j,
          8.91244121e-01 +4.83414008e-02j,
         -6.95904468e-02 -6.14480203e-02j,
          2.19027156e-01 +2.23491425e-01j,
         -1.91797662e-15 -2.26636792e-15j,
          9.44987077e-16 +1.63552133e-15j,
         -4.20004941e-16 -9.65296659e-16j,
          5.32682049e-16 -1.62539771e-15j,
          1.09886379e-15 +5.89371973e-16j,
         -1.75767064e-16 -1.32944218e-16j],
       [  9.52032113e-03 +9.04258893e-02j,
          6.64222334e-03 -1.56106100e-01j,
         -1.17230931e-01 -1.31247854e-01j,
          9.63656712e-02 -1.16863838e-01j,
          9.32265103e-01 +1.80248931e-01j,
         -1.81305123e-02 +1.07098477e-01j,
         -2.11577555e-15 +7.53707494e-17j,
          2.37036029e-15 +2.69241745e-16j,
         -7.76650855e-16 +1.14158405e-15j,
          1.43892610e-15 -6.95862820e-16j,
          1.72052752e-15 -1.34169591e-16j,
          8.23387801e-16 -1.17553665e-15j],
       [  3.63373760e-02 -7.61455093e-02j,
         -7.68644066e-02 -2.82231787e-02j,
          7.18985845e-02 -8.51456722e-02j,
         -1.99116515e-01 +2.26092744e-01j,
          5.69722611e-02 +1.13379488e-01j,
          9.25105212e-01 -1.05222924e-01j,
         -4.72958728e-16 -1.65677315e-16j,
         -2.53622736e-15 +3.16188697e-15j,
         -2.17826331e-17 -6.65828952e-16j,
          1.25899440e-15 -3.60190253e-16j,
          1.12985505e-15 +2.40084893e-15j,
          6.31459936e-16 -7.83294593e-16j],
       [ -2.97941063e-17 -3.29443502e-16j,
          9.42915864e-16 +5.96239131e-17j,
          2.04619935e-15 +2.76125361e-16j,
         -9.82728756e-16 +2.49687216e-15j,
         -4.69276169e-16 -4.61723789e-17j,
         -4.32636268e-16 +4.31733656e-16j,
         -9.92558394e-01 -4.04583542e-03j,
         -1.18172070e-02 -5.55357696e-02j,
         -7.69124138e-03 -2.99830750e-02j,
         -9.47243068e-02 +2.45486417e-02j,
         -1.12544132e-02 +2.63399651e-02j,
         -5.44179073e-03 +1.42849296e-02j],
       [ -1.98259727e-15 +4.43598487e-16j,
          6.98977835e-17 -1.50429676e-16j,
         -3.53765153e-15 -3.28931084e-16j,
          2.00445416e-15 -1.92474081e-15j,
          1.79855067e-15 -2.50922555e-16j,
         -1.66812227e-15 -2.99743957e-15j,
          1.21718287e-02 -5.91596448e-02j,
         -9.96137158e-01 +3.17922026e-02j,
         -2.67959396e-02 -4.47970030e-03j,
         -5.92630603e-03 +1.88690746e-02j,
         -4.63927666e-03 +2.40911237e-02j,
          3.63211643e-02 -1.27113766e-03j],
       [ -8.06053513e-16 -1.91151904e-16j,
         -1.86182591e-17 -5.69456210e-16j,
          7.57347732e-16 +8.94742354e-16j,
         -8.53768692e-16 +5.21762688e-16j,
          4.44983516e-16 -1.45627788e-15j,
         -5.35270342e-16 +9.75892936e-16j,
          4.37101072e-03 -3.30158301e-02j,
          2.88237511e-02 -4.00156457e-03j,
         -9.92742765e-01 -6.43514797e-02j,
          5.94419075e-02 +4.74685677e-02j,
         -1.98794534e-02 -4.34089293e-02j,
          1.02228175e-02 +1.39312354e-02j],
       [  1.82547275e-16 +3.81199904e-16j,
         -1.32525977e-15 -3.19985980e-15j,
          1.69168673e-16 -1.34698064e-15j,
          4.94091079e-16 +6.87805144e-16j,
          1.23246520e-15 +1.24532884e-15j,
          2.35927941e-15 +9.45029822e-16j,
          9.15490124e-02 +1.86039188e-02j,
          7.54937439e-03 +2.27792046e-02j,
         -5.72060494e-02 +5.16072133e-02j,
         -9.88946645e-01 +5.23384236e-02j,
         -4.16742199e-03 -6.28530549e-02j,
          3.67302879e-03 +4.98079486e-03j],
       [ -3.40064768e-16 -7.72254665e-16j,
         -1.29470738e-15 +1.26237639e-16j,
         -1.18113897e-15 -1.71704929e-15j,
          6.19976058e-16 -6.50459219e-16j,
          1.92068396e-15 +8.65128837e-16j,
          7.14926129e-16 -1.93442128e-15j,
          8.93202189e-03 +3.42543754e-02j,
         -3.19949508e-03 +2.64416019e-02j,
          1.87608165e-02 -4.19024744e-02j,
          1.60677942e-03 -5.74009367e-02j,
         -9.88097242e-01 -3.39538140e-02j,
         -1.23055002e-01 -8.20476714e-04j],
       [ -3.67203947e-16 +2.26650272e-17j,
          9.89244079e-16 -1.19344682e-15j,
         -2.53337246e-16 +7.76007636e-16j,
         -4.37448931e-16 +5.99008812e-16j,
          4.54393693e-16 +1.15362249e-15j,
          4.67750023e-16 +8.23144977e-16j,
          4.91740166e-03 +7.04604338e-03j,
         -3.65649498e-02 -2.65574512e-03j,
         -1.44028754e-02 +1.93234392e-02j,
         -1.38774655e-03 +1.38834075e-02j,
          1.21812800e-01 +1.69088093e-03j,
         -9.91281456e-01 +1.80684554e-02j]]), array([[ -9.99461028e-01 +6.18333510e-03j,
         -1.65600655e-03 -5.61547917e-03j,
          1.83939476e-16 +5.65347757e-18j,
         -2.06292808e-16 -5.68924983e-16j,
          1.82789862e-02 -1.71892958e-02j,
         -3.53724270e-03 -2.22156541e-03j,
         -7.65237067e-03 -4.59792047e-03j,
          1.30772655e-02 -1.03628232e-02j,
         -1.61955558e-15 +8.14069181e-16j,
          7.37503268e-17 +2.02759996e-16j,
         -1.10847846e-15 -2.01768075e-15j,
          7.62722981e-16 +4.01318417e-16j],
       [  1.27723339e-03 -6.21606661e-03j,
         -9.97117152e-01 +2.60340568e-02j,
         -6.21177206e-16 +6.32628235e-16j,
          7.21048492e-16 +8.69565626e-16j,
         -1.05098997e-02 -4.13947557e-04j,
         -2.87424521e-02 -7.62159832e-03j,
          2.79313847e-02 +5.33695314e-02j,
          1.36240683e-02 -1.51793321e-02j,
          5.12000532e-16 +2.01826215e-15j,
          9.71601403e-16 -1.64420760e-16j,
         -2.27213825e-15 +3.52785187e-16j,
          7.56015326e-16 +1.80229327e-16j],
       [  1.31221143e-17 -2.81499725e-16j,
          1.27457750e-15 -7.73475491e-16j,
          3.87061147e-01 +8.79173103e-01j,
          1.64810275e-01 +1.90924611e-01j,
          1.20503631e-15 -7.24389016e-16j,
          8.69521169e-16 -1.35515063e-15j,
         -1.75273425e-16 +1.36147996e-15j,
         -6.40465038e-16 +6.96547802e-16j,
          3.30617714e-03 +1.28439291e-03j,
         -3.05154162e-02 +4.09752346e-02j,
          3.38317336e-02 +2.28937848e-02j,
          8.75292978e-02 -4.08761523e-02j],
       [  3.07889139e-16 -1.74130581e-16j,
         -4.61461305e-18 -8.36002164e-16j,
         -1.32528001e-01 +2.23412959e-01j,
          2.30419193e-01 -9.17627087e-01j,
         -1.44828158e-15 -8.85473634e-16j,
          4.58901819e-17 +1.63426821e-15j,
          1.66035703e-16 -5.65052805e-16j,
          4.58124333e-16 -6.87632246e-16j,
          2.94421918e-02 +1.58833462e-02j,
          9.25505332e-03 -9.27984046e-02j,
         -1.05200728e-01 -7.19410674e-02j,
         -3.27544207e-02 -1.01284841e-01j],
       [ -1.89703544e-02 -1.55796227e-02j,
          1.77423630e-02 -7.89880165e-04j,
         -1.01394773e-15 +2.02148778e-16j,
          3.93887662e-16 +1.37491890e-15j,
         -9.89061971e-01 +1.25172098e-02j,
         -1.07053271e-02 -6.60650161e-02j,
          8.72764591e-02 +7.23994172e-02j,
          4.72144164e-02 +3.33837439e-02j,
         -5.63519236e-17 +1.35352471e-15j,
         -4.56926909e-16 -1.46180512e-15j,
         -2.01302182e-16 -2.13027668e-15j,
         -2.50038049e-16 +5.13111984e-16j],
       [  5.00024912e-03 -4.13679437e-03j,
          3.35475042e-02 -9.90793521e-03j,
         -9.12201669e-16 +1.22241814e-15j,
         -1.38678143e-15 -3.28807151e-17j,
          1.66044727e-02 -6.87160326e-02j,
         -9.91515857e-01 -5.35441610e-03j,
          5.21313228e-02 +5.29591284e-02j,
         -5.71286175e-03 -7.10586783e-02j,
          8.77351173e-16 +2.03858467e-16j,
         -1.00774080e-15 -1.40671349e-15j,
         -1.37045532e-16 +1.09749040e-15j,
         -9.71208127e-16 -3.37994736e-16j],
       [  3.58506628e-03 -6.25304577e-03j,
         -2.48856676e-02 +4.96261465e-02j,
          1.61132814e-15 -1.75735119e-17j,
          1.02353124e-16 -6.88559941e-16j,
         -9.28113821e-02 +7.19217804e-02j,
         -5.87616483e-02 +4.31602540e-02j,
         -9.85914478e-01 -1.08846600e-03j,
         -7.49700782e-02 -1.07007720e-02j,
         -3.99320571e-16 -5.29494009e-16j,
         -8.12616766e-16 +1.18356556e-15j,
          1.41251309e-15 -7.18599072e-16j,
          8.39616797e-16 -2.19659135e-15j],
       [ -1.41091925e-02 -1.01691347e-02j,
         -1.07138347e-02 -1.75921374e-02j,
         -4.82249501e-16 -1.32150176e-15j,
          7.32713241e-16 -3.40217378e-16j,
         -3.63481842e-02 +2.74595387e-02j,
          9.97721312e-03 -7.79198135e-02j,
          7.66471457e-02 -2.70250419e-03j,
         -9.91838194e-01 -3.74419590e-02j,
         -2.51067703e-16 -3.67818016e-16j,
          5.24712522e-16 -1.13446417e-15j,
          2.21418386e-15 +3.09243081e-15j,
          7.12651461e-16 -1.19409964e-15j],
       [ -1.40738566e-15 +4.27302463e-17j,
         -2.35869336e-16 -1.11086415e-15j,
         -6.88573709e-03 -4.75728953e-02j,
          5.35240291e-02 -9.23961439e-02j,
         -8.15595785e-17 -8.42179304e-16j,
          9.59176605e-16 -4.74913217e-16j,
         -1.09472290e-17 +1.73586535e-15j,
          2.66426840e-15 -1.17143207e-15j,
          1.23141472e-01 +4.60060169e-01j,
         -5.46258908e-01 -1.48510509e-02j,
          5.08370177e-01 +4.24747649e-01j,
          1.35123173e-01 +6.11550021e-02j],
       [ -1.92135761e-15 -2.27787103e-16j,
          6.16496393e-16 -1.40519002e-15j,
          8.23175449e-03 +3.25095504e-02j,
          6.67235463e-02 -1.15997213e-02j,
         -1.35384885e-15 -6.00125898e-17j,
          2.44765169e-16 -2.55890685e-16j,
         -1.70256431e-15 -1.11156435e-16j,
          6.87797222e-16 +1.40457364e-15j,
          6.29503237e-01 -8.78125504e-03j,
          4.65662062e-01 -7.68480353e-03j,
          2.44132332e-02 +4.40902849e-01j,
         -3.01844677e-01 +3.08116209e-01j],
       [  6.73813742e-16 +6.05695133e-16j,
         -1.86367551e-15 +1.57284279e-15j,
         -1.33832360e-02 +4.29703544e-02j,
          1.55433527e-02 -1.32128898e-01j,
         -9.62864469e-16 +8.82599466e-16j,
         -1.46821979e-15 -4.35965304e-16j,
          1.92667464e-16 -1.30783140e-15j,
          8.03587592e-16 -6.93215105e-16j,
         -5.98844033e-01 -4.65603276e-03j,
          2.86353834e-01 +4.66194463e-01j,
          3.47587338e-01 +1.29968103e-01j,
         -1.99959738e-01 +3.80276983e-01j],
       [ -9.05042224e-16 -2.84802308e-16j,
         -1.75001775e-16 -1.54129765e-15j,
         -5.60702010e-02 -3.40095145e-02j,
         -8.19517308e-02 -2.91326238e-02j,
         -1.77991979e-15 +5.76551519e-16j,
         -1.01627418e-15 +8.92674195e-16j,
          1.48489280e-15 +2.79202990e-16j,
          3.17134418e-15 +1.04581510e-15j,
         -7.90205601e-02 -1.04007578e-01j,
          3.98656690e-01 +1.22107033e-01j,
          1.43146734e-01 +4.35943569e-01j,
          4.27610571e-01 -6.35489573e-01j]]), array([[ -6.94813496e-01 +6.84282824e-01j,
         -1.61091487e-15 +5.09508269e-16j,
          2.44428849e-15 +2.55673540e-15j,
          2.38440965e-15 -8.91833669e-16j,
          8.36488770e-16 -1.04430813e-15j,
         -9.77348733e-16 -8.22636444e-16j,
          4.44865998e-16 +7.67989337e-16j,
         -5.14978390e-02 +1.50059806e-02j,
          4.78297798e-02 +1.27557892e-01j,
         -5.89498253e-02 -7.61479701e-03j,
          4.47705934e-02 +1.96274304e-02j,
         -1.19639120e-01 +8.55516388e-02j],
       [  1.16092417e-15 -5.40633580e-16j,
         -9.97936192e-01 -5.97079622e-02j,
         -5.46295286e-03 -7.16823590e-03j,
          1.52019543e-02 -5.70238099e-04j,
          8.79459314e-03 +9.70155542e-03j,
         -7.59637940e-03 +3.21003367e-04j,
          3.13627141e-03 +2.56032230e-03j,
         -5.45699136e-16 -2.30232533e-15j,
          2.10123559e-15 -1.66283711e-15j,
          2.61603758e-16 +1.53376916e-15j,
         -1.76458754e-16 -3.09125081e-16j,
          2.92380550e-16 +1.08572794e-15j],
       [ -3.91768080e-17 +3.92065540e-15j,
          3.95503628e-03 -7.81687742e-03j,
         -9.88515885e-01 +1.08896212e-01j,
         -8.59418422e-02 -1.29599979e-02j,
          2.85828008e-02 -1.54761442e-02j,
         -2.21234339e-02 -3.21813826e-02j,
         -2.70963503e-02 -5.60938844e-03j,
          1.96668699e-15 -3.23689057e-16j,
         -1.03482026e-15 -1.08611825e-16j,
          4.59899720e-16 -2.62034760e-16j,
          1.76807469e-15 -2.84501760e-15j,
         -3.04203056e-15 -1.17278774e-15j],
       [ -2.44119456e-15 +2.39966504e-16j,
         -1.46803815e-02 -3.48900901e-03j,
          8.73711498e-02 -1.56079507e-02j,
         -9.85749459e-01 -1.13709853e-01j,
          5.03953237e-02 -3.62170518e-02j,
         -4.26854728e-02 +3.76236642e-02j,
         -8.47443123e-03 +1.01139535e-02j,
         -1.45270720e-16 -5.16546964e-16j,
          1.58419788e-15 +9.55355799e-16j,
          1.75515173e-15 +2.61618549e-16j,
         -1.05218556e-15 -1.37142882e-15j,
         -8.03181940e-17 -9.22381139e-16j],
       [ -2.45134608e-15 +1.10168194e-15j,
         -9.85794439e-03 +7.97609006e-03j,
         -2.63137741e-02 -4.00673391e-03j,
         -5.17813572e-02 -4.24714730e-02j,
         -9.87633524e-01 +4.81455040e-02j,
          4.10635018e-02 +2.34990482e-02j,
          1.86981783e-02 -1.19664506e-01j,
          2.13279235e-15 +1.70817933e-15j,
         -3.47413423e-15 -1.21190826e-15j,
          8.44636300e-16 -1.20615724e-15j,
          8.62956930e-16 -1.64825282e-15j,
          1.52643257e-15 -1.41433023e-15j],
       [ -7.29337623e-16 -8.64138796e-16j,
          7.68933740e-03 +2.52934850e-03j,
          1.49769122e-02 -3.71399853e-02j,
          3.75395548e-02 +3.95467541e-02j,
         -4.52506277e-02 +1.76059350e-02j,
         -9.94080091e-01 -8.07629173e-03j,
         -6.86105517e-02 -5.67233664e-03j,
         -4.30700883e-16 +9.32138803e-17j,
         -1.03345413e-15 -5.25825700e-16j,
          7.73728871e-16 +1.14278962e-15j,
          3.16507861e-16 +4.86943472e-16j,
          1.21443693e-15 -1.70058576e-15j],
       [  4.03844166e-16 +5.16831181e-16j,
         -4.94724973e-03 +1.75727617e-03j,
          2.44136528e-02 -1.05463496e-02j,
          1.11068181e-02 +1.01354875e-03j,
         -2.57952974e-02 -1.18994669e-01j,
          6.84133534e-02 -5.06476447e-04j,
         -9.89470896e-01 +2.41323272e-02j,
         -2.40179233e-15 +1.02319073e-15j,
          1.90467617e-15 -1.42405574e-15j,
          5.38549219e-16 -3.93035734e-16j,
          4.59886448e-16 +2.69957763e-15j,
         -3.38355582e-16 +1.85960085e-15j],
       [  4.77839036e-02 -1.38734607e-02j,
          1.57227376e-15 -2.22461980e-15j,
         -1.97114238e-15 -1.20388357e-15j,
         -1.62608331e-16 -5.02116070e-16j,
         -3.11854248e-15 +2.46885630e-15j,
         -2.99726547e-17 -2.41767604e-16j,
          2.04403845e-15 +5.63957621e-16j,
         -7.28028701e-01 -4.81925467e-01j,
         -1.01924953e-01 -5.13873581e-02j,
          2.53701988e-01 +2.11763468e-01j,
          1.79270675e-01 +1.69743001e-01j,
         -9.45252662e-02 +2.07660231e-01j],
       [ -7.62106122e-02 +1.10769462e-01j,
          1.86100385e-16 -2.40826728e-15j,
          1.03803486e-15 -9.64318461e-16j,
         -5.15921905e-16 +3.77751126e-16j,
          3.23118736e-15 -5.61464800e-16j,
          2.52202824e-16 +1.48233587e-16j,
         -1.94817696e-15 -1.38256446e-15j,
         -1.29633636e-01 -1.82367126e-01j,
         -5.24449795e-01 -4.14460650e-01j,
         -2.37062162e-01 -8.21705551e-02j,
         -1.99681487e-01 -4.98399365e-01j,
          3.52066047e-01 -9.92905268e-02j],
       [  8.77992106e-02 +1.37587910e-03j,
          1.64923220e-16 -5.82735117e-16j,
         -9.35848970e-16 +3.26211537e-16j,
         -1.95663672e-15 -1.67696210e-15j,
         -9.20868209e-16 -1.37255153e-15j,
         -1.43015528e-15 +8.04888183e-16j,
          9.72348104e-16 -2.24891904e-16j,
         -1.56379380e-01 -1.87856388e-01j,
         -1.87108426e-02 +1.66169019e-01j,
         -4.96418325e-01 -7.04396200e-01j,
          6.53196676e-02 +3.77746961e-01j,
          1.15843382e-01 +3.99794932e-02j],
       [ -1.10783527e-01 -4.44258791e-02j,
          2.32603332e-15 -1.21326373e-15j,
         -3.87782435e-15 +4.70271537e-17j,
         -5.71845840e-16 -1.33566421e-15j,
         -2.17783437e-15 +2.06784266e-15j,
         -3.40853531e-17 +1.57945893e-15j,
          1.96774441e-15 +9.21507187e-16j,
         -1.84335256e-01 +1.40033700e-01j,
          4.01209633e-01 -3.42871525e-01j,
         -1.08337065e-01 +1.45030055e-01j,
         -6.22922811e-01 +3.11344680e-01j,
          2.98164841e-01 +2.16778984e-01j],
       [  4.62687848e-02 -6.58746745e-02j,
          5.35635528e-17 -4.64080335e-16j,
         -3.39095759e-18 -1.38712456e-15j,
         -2.68347858e-15 +8.16343314e-16j,
          6.87216731e-16 +7.62690922e-16j,
         -1.89208624e-15 +9.73801397e-16j,
          2.42516415e-16 -4.57481511e-16j,
          1.47743339e-01 +2.22756926e-01j,
         -4.49666772e-01 -1.13552740e-01j,
         -2.05486721e-01 +8.18987803e-02j,
         -4.41718718e-02 +1.20441504e-01j,
         -3.77560503e-01 +7.06424170e-01j]]), array([[ -9.33430641e-01 +3.06038621e-01j,
          1.31008565e-15 -2.57448531e-15j,
         -4.22519315e-02 +5.74235901e-02j,
          1.69607719e-16 -2.66406148e-15j,
          1.63248794e-16 -3.80193967e-16j,
         -4.88141515e-02 -1.15527493e-01j,
          5.97997455e-17 +1.81418765e-16j,
          4.14074934e-02 -8.88046750e-02j,
          5.39222132e-02 +1.93549362e-02j,
          6.81251682e-16 -2.11103132e-16j,
          7.44254391e-16 -9.75533639e-16j,
          1.74645152e-02 -3.23636311e-02j],
       [ -1.43432026e-15 -2.41118682e-15j,
         -9.94674999e-01 -8.10710663e-02j,
          4.70248649e-16 -5.23128299e-16j,
         -4.34637291e-02 +8.48791157e-03j,
          1.41682571e-02 +2.61892239e-02j,
          1.31025787e-15 +1.15891156e-15j,
         -4.93995181e-03 -2.64933193e-02j,
          1.04965387e-15 -1.20692657e-15j,
          2.03368742e-15 +4.38302304e-16j,
          1.51673152e-02 -7.15005952e-03j,
         -1.15738970e-02 +7.74268832e-03j,
          1.27109310e-15 -3.92578747e-16j],
       [  2.20813820e-02 +4.82590782e-02j,
         -1.57248780e-16 +3.06004237e-16j,
         -8.68621353e-01 -4.29670587e-01j,
          1.36334760e-15 +5.12605872e-17j,
          9.24517965e-19 -8.28853480e-16j,
         -1.36433957e-01 +9.85460718e-03j,
         -6.94945097e-16 -8.05584701e-16j,
         -1.91978786e-02 +4.81338753e-02j,
         -8.88047518e-03 +2.74433887e-02j,
          1.61892463e-15 -1.56441607e-15j,
         -8.71543877e-16 -1.12738772e-15j,
         -1.32490228e-01 +1.35207899e-01j],
       [ -5.96778967e-16 -2.65776558e-15j,
          4.34906323e-02 +6.21687211e-03j,
         -6.33240703e-16 -8.96521590e-16j,
         -9.90454939e-01 +1.00838187e-01j,
         -5.00031443e-03 -6.14671466e-02j,
         -7.09705420e-16 +1.38914087e-15j,
         -2.38861782e-02 -4.19908282e-02j,
          3.64979999e-16 +9.45588348e-16j,
          2.33469818e-16 +1.55229371e-15j,
          1.42560015e-02 -2.28883450e-02j,
          2.49211179e-03 -5.50234954e-03j,
         -6.16774736e-16 +1.30012687e-15j],
       [ -5.64683396e-16 -1.25516421e-16j,
         -1.79592269e-02 +2.72348398e-02j,
         -8.75652524e-17 -4.18745091e-16j,
         -4.36198656e-04 -6.24743591e-02j,
         -9.87709939e-01 -1.68609346e-02j,
          6.73543148e-16 -9.00934987e-16j,
         -1.90110894e-02 -3.55667305e-02j,
         -2.26983690e-16 +1.32942052e-15j,
         -5.56023612e-16 -9.61091842e-17j,
         -1.04708457e-01 +1.03524578e-02j,
         -3.97042794e-02 -7.00242918e-02j,
         -1.05124030e-16 -5.85574455e-16j],
       [  4.88475033e-02 -1.42769300e-01j,
          5.06412027e-16 -1.03430359e-17j,
          3.38599855e-02 +1.01122742e-01j,
         -1.13789134e-15 +9.31372508e-16j,
         -2.82414574e-16 +4.12365729e-17j,
         -8.54052029e-01 -2.93721743e-01j,
          6.87586785e-16 -1.04000192e-15j,
         -2.62425456e-01 -1.95001518e-01j,
         -8.79150809e-02 +4.41110221e-02j,
         -2.74323544e-17 -7.09108197e-16j,
          6.20800127e-16 -1.16504385e-15j,
          7.55760352e-02 -1.67038670e-01j],
       [  5.99776819e-16 +2.49509658e-16j,
          6.88833895e-03 -2.35491044e-02j,
          4.42773706e-16 -3.34572528e-16j,
          2.50713094e-02 -4.20832578e-02j,
          2.34465754e-02 -3.04182513e-02j,
          7.65969633e-17 -1.51946622e-15j,
         -9.90336592e-01 -4.39223501e-02j,
         -1.45811143e-15 -7.68095018e-16j,
         -1.29745604e-15 +2.20714853e-15j,
          6.43595169e-02 -1.57484543e-02j,
         -3.23800178e-02 -8.59595416e-02j,
          2.74112942e-16 +4.68831708e-16j],
       [ -6.86488126e-02 -8.16587215e-03j,
         -2.08956245e-15 -2.54648535e-15j,
         -3.73607127e-02 +3.08796078e-02j,
         -2.00190172e-15 +9.93530643e-16j,
          5.90246575e-16 +1.16052210e-15j,
          2.32106564e-01 -1.80822526e-01j,
          6.18009020e-17 +1.14294793e-16j,
         -8.33255964e-01 +3.77225436e-01j,
         -6.26142574e-02 -2.26281097e-01j,
          1.28527629e-16 +3.07388492e-16j,
          8.29861310e-16 +1.08541541e-16j,
          1.18140971e-01 +2.46077894e-02j],
       [ -5.54350914e-02 +3.62693826e-02j,
         -5.89836925e-16 +9.79053326e-17j,
          5.03611213e-02 -2.19451422e-02j,
         -1.45590303e-16 +9.04392013e-16j,
          3.55633173e-16 -1.96595200e-16j,
          3.00760149e-02 +1.25874591e-01j,
          1.07092781e-15 +7.85681387e-16j,
         -2.11165155e-02 -1.61231494e-01j,
         -9.09425139e-01 +7.43045926e-02j,
         -1.11018598e-15 -1.32885218e-15j,
          2.66961729e-16 -5.53762554e-17j,
          8.26509873e-02 +3.31657546e-01j],
       [ -3.98473693e-16 -2.53153984e-16j,
         -1.22511677e-02 -1.18165185e-02j,
         -1.37319891e-15 -1.17659904e-15j,
         -1.70327036e-02 -1.64234528e-02j,
          1.00230828e-01 +4.27368181e-03j,
         -4.86794468e-16 -5.97767261e-16j,
         -6.99199916e-02 -7.95060630e-03j,
          8.48060763e-16 +2.10394299e-17j,
          4.93265462e-16 -1.03148386e-15j,
         -9.84616202e-01 +7.22990652e-02j,
          7.46171996e-02 +6.22092407e-02j,
         -1.59878276e-15 -7.58724797e-16j],
       [ -6.30013996e-16 -6.55933409e-16j,
          9.78376594e-03 +8.20498685e-03j,
          1.06686100e-15 -6.34142686e-16j,
          2.45286451e-03 +9.30977125e-04j,
          5.32954668e-02 -7.12394234e-02j,
          4.41570532e-16 -1.48687759e-15j,
          3.63805527e-02 -7.96379815e-02j,
         -1.12383537e-15 -1.70964979e-16j,
         -1.49539277e-15 -2.01782910e-17j,
         -6.92355849e-02 +6.35668010e-02j,
         -9.87126759e-01 -3.15486124e-02j,
          5.56813997e-16 -9.80294375e-16j],
       [  4.68055698e-03 -1.64971873e-02j,
         -7.63489428e-16 +8.30849790e-16j,
          3.57973959e-02 +1.94361702e-01j,
          6.60744247e-16 +4.54083361e-16j,
          2.87809831e-16 -5.09171186e-17j,
          8.43759169e-02 -1.98603602e-01j,
          1.19220684e-15 +4.35311657e-16j,
         -1.33180534e-01 -5.28410233e-03j,
         -8.32395575e-02 +3.02627122e-01j,
          6.04269759e-16 -1.41774250e-15j,
          2.35798164e-16 -1.20008489e-15j,
         -8.93175476e-01 -6.77628134e-03j]]), array([[-0.92143046-0.06374662j,  0.11573238+0.02308363j,
         0.14456902+0.15465513j,  0.00927601-0.08029813j,
        -0.08514394-0.11357846j, -0.08527196+0.02212557j,
        -0.05161732-0.00883175j, -0.01686474+0.02262237j,
         0.00498289-0.0920892j , -0.08148840+0.02151737j,
         0.07583731+0.10432528j,  0.08768746-0.10120029j],
       [-0.16696318+0.01310962j, -0.90412554+0.1973896j ,
         0.02167589-0.18876717j,  0.07529667+0.05521622j,
         0.05057445+0.12646489j,  0.11336326-0.05274025j,
        -0.03672168-0.0729041j ,  0.07360988-0.0059855j ,
        -0.00723893-0.13205663j, -0.03667913-0.039341j  ,
        -0.04743941-0.00637801j, -0.03973668+0.01297079j],
       [-0.17024397+0.06363851j, -0.06482157-0.04287175j,
        -0.75439876+0.03788652j, -0.11242435+0.01913442j,
        -0.24239517+0.02931262j,  0.00369111+0.24546346j,
         0.14289853-0.03692519j, -0.04156821+0.07890355j,
         0.01305302+0.04909249j,  0.40048286+0.1089989j ,
        -0.14338205-0.11872752j,  0.10954824+0.0790452j ],
       [ 0.05220044-0.03974946j, -0.06340337+0.08149359j,
         0.03988501-0.12561926j, -0.74062597+0.19908048j,
        -0.09014445-0.14416881j, -0.17345487+0.07991925j,
         0.03903804-0.26587876j, -0.02269079-0.21607351j,
        -0.04619188+0.09447919j, -0.00517935-0.19374778j,
         0.07862285+0.30359982j,  0.05380863-0.21172093j],
       [ 0.14436428-0.09662585j, -0.09359597+0.13132756j,
         0.13836121+0.15293074j,  0.06123598-0.22454927j,
        -0.61796812-0.34936298j,  0.26061406+0.04967032j,
         0.00935069-0.07387418j,  0.13834906-0.04349029j,
        -0.10601934-0.02521392j,  0.11636877+0.02514515j,
         0.44913456-0.10331129j, -0.06347223+0.06111608j],
       [ 0.04810395-0.03468896j, -0.10873002+0.10711596j,
         0.17644180+0.03538308j,  0.02530288-0.16040785j,
         0.00910632+0.31021619j, -0.42696771+0.2882808j ,
        -0.15717401+0.17271735j, -0.06275740+0.20971597j,
         0.26604506+0.25863567j,  0.30113156-0.0076782j ,
         0.34951066+0.23891162j,  0.05532188+0.19885936j],
       [-0.01944851+0.05876738j, -0.03726765-0.10330785j,
        -0.18190606+0.01592958j, -0.16656046-0.15932854j,
         0.09112682-0.15200569j,  0.24798684-0.08638076j,
        -0.70442478+0.11353201j,  0.21225015-0.18819436j,
         0.31157569+0.2712759j , -0.10361658+0.10089631j,
        -0.02376595-0.02042256j,  0.12017150+0.02618532j],
       [ 0.01926068-0.0376269j ,  0.02188030+0.00454957j,
         0.11413749-0.05345135j, -0.00784106-0.22614879j,
         0.15414934+0.0615315j ,  0.35791908+0.17139581j,
        -0.17068204-0.16354849j, -0.70476359-0.20499133j,
        -0.02951995-0.19124487j,  0.27544367+0.14403083j,
         0.00155244+0.09262547j, -0.01481675-0.09021481j],
       [-0.05275802-0.07344496j, -0.07111585-0.14540096j,
        -0.21132102+0.2333359j , -0.16444466-0.13041942j,
         0.26753027+0.13497161j, -0.12134673+0.09211748j,
        -0.10322225+0.2317403j ,  0.03248079-0.27356119j,
        -0.53453765-0.06609871j, -0.09326838-0.08575289j,
         0.30818572-0.12393663j, -0.36207194+0.14708356j],
       [ 0.15507817+0.04036147j, -0.10231487+0.02253923j,
        -0.12630814+0.21046797j, -0.16328482-0.24529512j,
        -0.16976773+0.04623947j, -0.21450641+0.18697582j,
        -0.09777257-0.08544237j, -0.27664034+0.30156983j,
         0.06700748-0.24198627j, -0.62703099+0.10933293j,
        -0.04086163-0.14498025j,  0.16847794-0.0274648j ],
       [ 0.03838282-0.03367479j, -0.00885824+0.05799503j,
         0.19576222-0.04432851j,  0.09709585+0.03258478j,
        -0.15585682-0.25939105j, -0.28517122+0.3596393j ,
        -0.37004493+0.11127179j,  0.01378012-0.01032189j,
        -0.15512356-0.11473107j,  0.19668607-0.30618216j,
        -0.49056347-0.223693j  , -0.15836692-0.07677117j],
       [-0.05461003-0.05250785j, -0.02081364+0.10026034j,
        -0.03978890+0.0760774j , -0.08166007-0.22509114j,
         0.03440633-0.00721797j,  0.03695510+0.03766509j,
         0.20001195-0.0315193j , -0.02737611+0.07778713j,
         0.37449836+0.26847012j, -0.05513456+0.0328743j ,
        -0.08613728-0.12542334j, -0.71235057-0.3467153j ]])], 'kpt': [[0.0, 0.0, 0], [0.125, 0.0, 0], [0.25, 0.0, 0], [0.375, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.27845916939863913, 0.013116085775938036, 0.98943347299635809, 0.98949568924165443, 0.015316977056123893]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)
        
    def test_supercell4(self):
        """test creating a supercell"""
        self.create_model(0.2, 0.3)
        model = self.model.supercell([1, 1, 1], [False, False, False])
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        tb_surface.wcc_calc(verbose=False,
                            num_strings=5,
                            pickle_file=None,
                            gap_tol=None,
                            move_tol=None)

        
        res = {'t_par': [0.0, 0.25, 0.5, 0.75, 1.0], 'wcc': [[1.1842505386442999e-18, 1.1842505386442999e-18, 0.5, 0.5], [1.1842505386442999e-18, 1.1842505386442999e-18, 0.5, 0.5], [1.1842505386442999e-18, 1.1842505386442999e-18, 0.5, 0.5], [1.1842505386442999e-18, 1.1842505386442999e-18, 0.5, 0.5], [1.1842505386442999e-18, 1.1842505386442999e-18, 0.5, 0.5]], 'lambda_': [array([[ 0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j]]), array([[ 0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j]]), array([[ 0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j]]), array([[ 0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j]]), array([[ 0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [-0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j,
         0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
         0.98058068 +1.04083409e-17j, -0.19611614 -3.12250226e-17j],
       [ 0.00000000 +0.00000000e+00j,  0.00000000 +0.00000000e+00j,
        -0.19611614 +2.01227923e-16j, -0.98058068 -1.11022302e-16j]])], 'kpt': [[0.0, 0.0, 0], [0.125, 0.0, 0], [0.25, 0.0, 0], [0.375, 0.0, 0], [0.5, 0.0, 0]], 'gap': [0.25, 0.25, 0.25, 0.25, 0.25]}

        self.assertFullAlmostEqual(tb_surface.get_res(), res)

    def test_precompute(self):
        """ test that precomputation will be redone after changing _hop or _on_site"""
        self.create_model(0.1, 0.3)
        self.model._unchanged = True
        self.model._hop = []
        self.assertEqual(self.model._unchanged, False)
        self.model._unchanged = True
        self.model._on_site = []
        self.assertEqual(self.model._unchanged, False)

    def test_warning(self):
        """ test the warning that is given when string_vec != None"""
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        with warnings.catch_warnings(record=True) as w:
            warnings.simplefilter('always')
            tb_surface = tb_system.surface(lambda kx: [kx / 2, 0, 0], [0, 1, 0])
            assert len(w) == 1
            assert w[-1].category == DeprecationWarning
            assert "string_vec" in str(w[-1].message)

    def test_saveload(self):
        self.create_model(0.1, 0.3)
        tb_system = z2pack.em.tb.System(self.model)
        surface1 = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=self._build_folder + '/tb_pickle.txt')
        surface2 = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0], pickle_file=self._build_folder + '/tb_pickle.txt')
        surface1.wcc_calc(verbose=False)
        surface2.load()
        self.assertFullAlmostEqual(surface1.get_res(), surface2.get_res())

    def testkwargcheck1(self):
        """ test kwarg check on wcc_calc """
        self.create_model(0.1, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        tb_surface = tb_system.surface(lambda kx, ky: [kx / 2, ky, 0])
        self.assertRaises(
            TypeError,
            tb_surface.wcc_calc,
            invalid_kwarg = 3)

    def testkwargcheck2(self):
        """ test kwarg check on __init__ """
        self.create_model(0, 0.3)
        # call to Z2Pack
        tb_system = z2pack.em.tb.System(self.model)
        self.assertRaises(
            TypeError,
            tb_system.surface,
            1, 2, 0, invalid_kwarg = 3)

if __name__ == "__main__":
    unittest.main()
