# -*- coding: utf-8 -*-
#
# Author:  Dominik Gresch <greschd@gmx.ch>
# Date:    15.10.2014 14:49:25 CEST
# File:    tb_hamilton.py

import sys
sys.path.insert(0, '../')
import z2pack

from common import *

import re
import platform
import types
import unittest


class FpPhonyTestCase(CommonTestCase):
    def __init__(self, *args, **kwargs):
        if(re.match('Windows', platform.platform(), re.IGNORECASE)):
            self._sep = '\\'
        else:
            self._sep = '/'

        super(FpPhonyTestCase, self).__init__(*args, **kwargs)

    def testphony1(self):
        sys = z2pack.fp.System(
            'samples' + self._sep + 'wannier90.mmn',
            lambda x, y, z, N: '',
            "kpts",
            'samples' + self._sep + 'build',
            "")

        plane = sys.plane(2, 0, 0, use_pickle=False)

        plane.wcc_calc(no_iter=True, no_neighbour_check=True, verbose=False)
        self.assertContainerAlmostEqual(
            plane.get_res(), ([0.0, 0.050000000000000003, 0.10000000000000001, 0.15000000000000002, 0.20000000000000001, 0.25, 0.30000000000000004, 0.35000000000000003, 0.40000000000000002, 0.45000000000000001, 0.5], [[1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025]], [0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905]))

    def testphony2(self):
        sys = z2pack.fp.System(
            'samples' + self._sep + 'varw90.mmn',
            lambda x, y, z, N: '',
            "kpts",
            'samples' + self._sep + 'build',
            "",
            file_names='wannier90.mmn')

        plane = sys.plane(2, 0, 0, use_pickle=False)

        plane.wcc_calc(no_iter=True, no_neighbour_check=True, verbose=False)
        self.assertContainerAlmostEqual(
            plane.get_res(), ([0.0, 0.050000000000000003, 0.10000000000000001, 0.15000000000000002, 0.20000000000000001, 0.25, 0.30000000000000004, 0.35000000000000003, 0.40000000000000002, 0.45000000000000001, 0.5], [[1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025]], [0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905]))


    def testphony3(self):
        sys = z2pack.fp.System(
            'samples' + self._sep + 'varw90.mmn',
            lambda x, y, z, N: '',
            "kpts",
            'samples' + self._sep + 'build',
            "",
            mmn_path='varw90.mmn')

        plane = sys.plane(2, 0, 0, use_pickle=False)

        plane.wcc_calc(verbose=False)
        self.assertContainerAlmostEqual(
            plane.get_res(), ([0.0, 0.050000000000000003, 0.10000000000000001, 0.15000000000000002, 0.20000000000000001, 0.25, 0.30000000000000004, 0.35000000000000003, 0.40000000000000002, 0.45000000000000001, 0.5], [[1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025]], [0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905]))

    def testphony4(self):
        sys = z2pack.fp.System(
            'samples' + self._sep + 'wannier90.mmn',
            lambda x, y, z, N: '',
            "kpts",
            'samples' + self._sep + 'build',
            "")

        plane = sys.plane(plane_edge_start=[0, 0, 0], plane_edge_end=[0, 1, 0], string_vec=[0, 0, 1], use_pickle=False)

        plane.wcc_calc(no_iter=True, no_neighbour_check=True, verbose=False)
        self.assertContainerAlmostEqual(
            plane.get_res(), ([0.0, 0.10000000000000001, 0.20000000000000001, 0.30000000000000004, 0.40000000000000002, 0.5, 0.60000000000000009, 0.70000000000000007, 0.80000000000000004, 0.90000000000000002, 1.0], [[1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025]], [0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905]))

    def testphony5(self):
        sys = z2pack.fp.System(
            'samples' + self._sep + 'varw90.mmn',
            lambda x, y, z, N: '',
            "kpts",
            'samples' + self._sep + 'build',
            "",
            file_names='wannier90.mmn')

        plane = sys.plane(plane_edge_start=[0, 0, 0], plane_edge_end=[0, 1, 0], string_vec=[0, 0, 1], use_pickle=False)

        plane.wcc_calc(no_iter=True, no_neighbour_check=True, verbose=False)
        self.assertContainerAlmostEqual(
            plane.get_res(), ([0.0, 0.10000000000000001, 0.20000000000000001, 0.30000000000000004, 0.40000000000000002, 0.5, 0.60000000000000009, 0.70000000000000007, 0.80000000000000004, 0.90000000000000002, 1.0], [[1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025]], [0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905]))
            
    def testphony6(self):
        sys = z2pack.fp.System(
            'samples' + self._sep + 'varw90.mmn',
            lambda x, y, z, N: '',
            "kpts",
            'samples' + self._sep + 'build',
            "",
            mmn_path='varw90.mmn')

        plane = sys.plane(plane_edge_start=[0, 0, 0], plane_edge_end=[0, 1, 0], string_vec=[0, 0, 1], use_pickle=False)

        plane.wcc_calc(verbose=False)
        self.assertContainerAlmostEqual(
            plane.get_res(), ([0.0, 0.10000000000000001, 0.20000000000000001, 0.30000000000000004, 0.40000000000000002, 0.5, 0.60000000000000009, 0.70000000000000007, 0.80000000000000004, 0.90000000000000002, 1.0], [[1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025], [1.5161969212760058e-13, 0.15757835196859474, 0.15757835196880809, 0.49999999999943007, 0.4999999999999602, 0.50000000000004452, 0.50000000000060962, 0.84242164803120345, 0.84242164803141328, 0.99999999999982025]], [0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905, 0.32878917598411905]))


if __name__ == "__main__":
    unittest.main()
